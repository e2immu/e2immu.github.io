<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="Annotations and a code analyser in Java to support immutability">
<meta name="author" content="Bart Naudts">
<title>Effective and eventual immutability</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Effective and eventual immutability</h1>
<div class="details">
<span id="author" class="author">Bart Naudts</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#installing">2. Installing e2immu</a>
<ul class="sectlevel2">
<li><a href="#_obtaining_the_analyser">2.1. Obtaining the analyser</a></li>
<li><a href="#_the_support_jar">2.2. The support jar</a></li>
<li><a href="#_the_analyser">2.3. The analyser</a></li>
<li><a href="#_the_annotation_store">2.4. The annotation store</a></li>
<li><a href="#_the_intellij_plugin">2.5. The IntelliJ plugin</a></li>
</ul>
</li>
<li><a href="#_using_e2immu"><em>Using e2immu</em></a></li>
<li><a href="#_using_e2immu_2">3. Using e2immu</a>
<ul class="sectlevel2">
<li><a href="#_basic_use">3.1. Basic use</a></li>
<li><a href="#_full_flow">3.2. Full flow</a></li>
<li><a href="#_the_analysers_command_line">3.3. The analyser&#8217;s command line</a></li>
<li><a href="#_the_gradle_plugin">3.4. The Gradle plugin</a></li>
</ul>
</li>
<li><a href="#_annotated_apis">4. Annotated APIs</a>
<ul class="sectlevel2">
<li><a href="#_purpose">4.1. Purpose</a></li>
<li><a href="#_preparing_annotated_api_files">4.2. Preparing Annotated API files</a></li>
<li><a href="#_the_annotated_api_file_format">4.3. The Annotated API file format</a></li>
<li><a href="#_annotation_types">4.4. Annotation types</a></li>
<li><a href="#_the_collections_framework">4.5. The Collections framework</a>
<ul class="sectlevel3">
<li><a href="#_not_null">4.5.1. Not null</a></li>
<li><a href="#_iterating_over_maps">4.5.2. Iterating over maps</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#annotationxml-files">5. Annotation XML files</a></li>
<li><a href="#_visualising_immutability">6. Visualising immutability</a></li>
<li><a href="#demo-project">7. The annotation store as a demo project</a></li>
<li><a href="#_reference"><em>Reference</em></a></li>
<li><a href="#_concepts">8. Concepts</a>
<ul class="sectlevel2">
<li><a href="#concept-modified">8.1. Modification</a></li>
<li><a href="#concept-hidden-content">8.2. Hidden content</a></li>
<li><a href="#concept-containers">8.3. Containers</a></li>
<li><a href="#concept-linking">8.4. Linking and independence</a>
<ul class="sectlevel3">
<li><a href="#_factory_methods">8.4.1. Factory methods</a></li>
</ul>
</li>
<li><a href="#_immutability">8.5. Immutability</a>
<ul class="sectlevel3">
<li><a href="#concept-e1immutable">8.5.1. Level 1 immutable</a></li>
<li><a href="#concept-e2immutable">8.5.2. Level n immutable</a></li>
<li><a href="#concept-recursively-immutable">8.5.3. Recursive immutability</a></li>
<li><a href="#_independence_of_a_type">8.5.4. Independence of a type</a></li>
<li><a href="#technical-dynamic-type-annotations">8.5.5. Dynamic type annotations</a></li>
</ul>
</li>
<li><a href="#concept-eventual">8.6. Eventual immutability</a></li>
<li><a href="#_miscellaneous">8.7. Miscellaneous</a>
<ul class="sectlevel3">
<li><a href="#concept-constant">8.7.1. Constants</a></li>
<li><a href="#concept-statement-time">8.7.2. Statement time</a></li>
<li><a href="#concept-singleton">8.7.3. Singleton classes</a></li>
<li><a href="#concept-utility-class">8.7.4. Utility classes</a></li>
<li><a href="#concept-extension-class">8.7.5. Extension classes</a></li>
<li><a href="#concept-finalizer">8.7.6. Finalizers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_analyser_details">9. Analyser details</a>
<ul class="sectlevel2">
<li><a href="#_preconditions">9.1. Preconditions</a></li>
<li><a href="#_instance_state">9.2. Instance state</a></li>
<li><a href="#companion-methods">9.3. Companion methods</a></li>
</ul>
</li>
<li><a href="#_overview_of_annotations">10. Overview of annotations</a>
<ul class="sectlevel2">
<li><a href="#list-of-annotations">10.1. List of annotations</a>
<ul class="sectlevel3">
<li><a href="#allowsInterrupt-annotation">10.1.1. @AllowsInterrupt</a></li>
<li><a href="#beforeMark-annotation">10.1.2. @BeforeMark</a></li>
<li><a href="#constant-annotation">10.1.3. @Constant</a></li>
<li><a href="#container-annotation">10.1.4. @Container</a></li>
<li><a href="#dependent-annotation">10.1.5. @Dependent</a></li>
<li><a href="#e1container-annotation">10.1.6. @E1Container</a></li>
<li><a href="#e1immutable-annotation">10.1.7. @E1Immutable</a></li>
<li><a href="#e2container-annotation">10.1.8. @E2Container</a></li>
<li><a href="#e2immutable-annotation">10.1.9. @E2Immutable</a></li>
<li><a href="#eRcontainer-annotation">10.1.10. @ImmutableContainer</a></li>
<li><a href="#extensionClass-annotation">10.1.11. @ExtensionClass</a></li>
<li><a href="#final-annotation">10.1.12. @Final</a></li>
<li><a href="#_finalizer">10.1.13. @Finalizer</a></li>
<li><a href="#_fluent">10.1.14. @Fluent</a></li>
<li><a href="#_identity">10.1.15. @Identity</a></li>
<li><a href="#_ignoremodifications">10.1.16. @IgnoreModifications</a></li>
<li><a href="#_independent">10.1.17. @Independent</a></li>
<li><a href="#independent1-annotation">10.1.18. @Independent1</a></li>
<li><a href="#_linked">10.1.19. @Linked</a></li>
<li><a href="#_linked1">10.1.20. @Linked1</a></li>
<li><a href="#_mark">10.1.21. @Mark</a></li>
<li><a href="#modified-annotation">10.1.22. @Modified</a></li>
<li><a href="#mutableModifiesArguments-annotation">10.1.23. @MutableModifiesArguments</a></li>
<li><a href="#notModified-annotation">10.1.24. @NotModified</a></li>
<li><a href="#notNull-annotation">10.1.25. @NotNull</a></li>
<li><a href="#notNull1-annotation">10.1.26. @NotNull1</a></li>
<li><a href="#nullable-annotation">10.1.27. @Nullable</a></li>
<li><a href="#only-annotation">10.1.28. @Only</a></li>
<li><a href="#singleton-annotation">10.1.29. @Singleton</a></li>
<li><a href="#sse-annotation">10.1.30. @StaticSideEffects</a></li>
<li><a href="#testMark-annotation">10.1.31. @TestMark</a></li>
<li><a href="#utilityClass-annotation">10.1.32. @UtilityClass</a></li>
<li><a href="#variable-annotation">10.1.33. @Variable</a></li>
</ul>
</li>
<li><a href="#annotation-hierarchy">10.2. Relations between annotations</a>
<ul class="sectlevel3">
<li><a href="#_on_types">10.2.1. On types</a></li>
<li><a href="#_on_fields">10.2.2. On fields</a></li>
<li><a href="#_on_constructors">10.2.3. On constructors</a></li>
<li><a href="#_on_methods">10.2.4. On methods</a></li>
<li><a href="#_on_parameters">10.2.5. On parameters</a></li>
<li><a href="#nullability">10.2.6. Nullability</a></li>
<li><a href="#_eventually_and_effectively_immutable">10.2.7. Eventually and effectively immutable</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_list_of_errors_and_warnings">11. List of errors and warnings</a>
<ul class="sectlevel2">
<li><a href="#_opinionated">11.1. Opinionated</a></li>
<li><a href="#evaluation-errors">11.2. Evaluation</a></li>
<li><a href="#_empty_unused">11.3. Empty, unused</a></li>
<li><a href="#_verifying_annotations">11.4. Verifying annotations</a></li>
<li><a href="#_immutability_2">11.5. Immutability</a></li>
<li><a href="#_odds_and_ends">11.6. Odds and ends</a></li>
</ul>
</li>
<li><a href="#_technical"><em>Technical</em></a></li>
<li><a href="#_implementation">12. Implementation</a>
<ul class="sectlevel2">
<li><a href="#_main_flow">12.1. Main flow</a></li>
<li><a href="#_inspection">12.2. Inspection</a></li>
<li><a href="#_resolution">12.3. Resolution</a></li>
<li><a href="#_analysers">12.4. Analysers</a></li>
<li><a href="#_statements_and_expressions">12.5. Statements and expressions</a></li>
<li><a href="#_analysis_objects">12.6. Analysis objects</a></li>
<li><a href="#_properties">12.7. Properties</a>
<ul class="sectlevel3">
<li><a href="#_value_properties">12.7.1. Value properties</a></li>
<li><a href="#_context_properties">12.7.2. Context properties</a></li>
<li><a href="#_external_properties">12.7.3. External properties</a></li>
</ul>
</li>
<li><a href="#_variables">12.8. Variables</a></li>
<li><a href="#_clustering">12.9. Clustering</a></li>
<li><a href="#_typical_execution_order">12.10. Typical execution order</a></li>
<li><a href="#_output_system">12.11. Output system</a></li>
</ul>
</li>
<li><a href="#_supporting_tools">13. Supporting tools</a>
<ul class="sectlevel2">
<li><a href="#_gradle_plugin">13.1. Gradle plugin</a></li>
<li><a href="#_key_value_store">13.2. Key-value store</a></li>
<li><a href="#_intellij_idea_plugin">13.3.  IntelliJ IDEA  plugin</a>
<ul class="sectlevel3">
<li><a href="#visual-objectives">13.3.1. Visual objectives</a></li>
<li><a href="#_information_flow">13.3.2. Information flow</a></li>
<li><a href="#_implementation_2">13.3.3. Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_where_next"><em>Where next?</em></a></li>
<li><a href="#_copyright_and_license">14. Copyright and License</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Main website: <a href="https://www.e2immu.org" class="bare">https://www.e2immu.org</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This document is work in progress.
In some places, it is nothing but a skeleton.
As of October 2021, it is two versions behind the <em>Road to immutability</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing">2. Installing e2immu</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_obtaining_the_analyser">2.1. Obtaining the analyser</h3>
<div class="paragraph">
<p>For now, the analyser&#8217;s binaries have not been uploaded to a central jar repository (like MavenCentral) yet.
Please clone the following projects from GitHub:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/e2immu/e2immu-support" target="_blank" rel="noopener">e2immu-support</a>, a small jar containing the annotations and some support classes</p>
</li>
<li>
<p><a href="https://github.com/e2immu/e2immu" target="_blank" rel="noopener">e2immu</a>, the analyser</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The support jar has been compiled with the Java 10+ API; this can easily be stripped down to Java 8 if required.
The analyser makes extensive use of the Java 16 API <em>and</em> language features.</p>
</div>
<div class="paragraph">
<p>The IntelliJ plugin is still in its infancy.
It is not yet available in IntelliJ&#8217;s plugin repository.
To experiment with it, clone</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/e2immu/e2immu-annotation-store" target="_blank" rel="noopener">e2immu-annotation-store</a>, the annotation store</p>
</li>
<li>
<p><a href="https://github.com/e2immu/e2immu-intellij-plugin" target="_blank" rel="noopener">e2immu-intellij-plugin</a>, the IntelliJ plugin</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_support_jar">2.2. The support jar</h3>
<div class="paragraph">
<p>The annotations and support classes can be compiled with any JDK providing the Java 10+ API.
Execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew publishToMavenLocal</code></pre>
</div>
</div>
<div class="paragraph">
<p>to make the jar, with reference <code>org.e2immu:e2immu-support:0.2.0</code>, locally available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_analyser">2.3. The analyser</h3>
<div class="paragraph">
<p>Please ensure you have at least a Java 16 JDK.
Gradle 7.0 (lower versions do not play nice with Java 16) is provided via the Gradle wrapper.</p>
</div>
<div class="paragraph">
<p>To make the jars available, publish them to your local Maven repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew publishToMavenLocal</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pushes the following jars to your local Maven repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.e2immu:analyser:0.1.2</code>, the analyser</p>
</li>
<li>
<p><code>org.e2immu:analyser-cli:0.1.2</code>, a small library extending the analyser with a command line</p>
</li>
<li>
<p><code>org.e2immu:analyser-store-uploader:0.1.2</code>, a small library to upload annotations to the annotation store</p>
</li>
<li>
<p><code>org.e2immu:gradle-plugin:0.1.2</code>, the Gradle plugin which you&#8217;ll need to run the analyser in a practical setting</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, version numbers may have changed when you read this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_annotation_store">2.4. The annotation store</h3>
<div class="paragraph">
<p>The annotation store is a separate project, consisting of two Java classes.
Build it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew build</code></pre>
</div>
</div>
<div class="paragraph">
<p>and start the annotation store with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew run</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>build.gradle</code> file provides support to change the port, in case 8281 is already occupied.
For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew run -De2immu-port=9999</code></pre>
</div>
</div>
<div class="paragraph">
<p>will start the annotation store listening to port 9999.
Please make sure this change of port is reflected in the configuration of the IDE plugin, which also needs to connect to the annotation store.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_intellij_plugin">2.5. The IntelliJ plugin</h3>
<div class="paragraph">
<p>The plugin is compiled with Java 8 language features only.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
At this point (April 2021), the analyser still crashes on the sources of the plugin!
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_e2immu"><em>Using e2immu</em></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_using_e2immu_2">3. Using e2immu</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basic_use">3.1. Basic use</h3>
<div class="paragraph">
<p>Starting your first project, basic use of the  <em>e2immu</em>  analyser looks like</p>
</div>
<div id="basic-use" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/e2immu_basic_use.png" alt="e2immu basic use">
</div>
<div class="title">Figure 1. Basic use of e2immu</div>
</div>
<div class="paragraph">
<p>Having installed  <em>e2immu</em> 's IntelliJ IDEA plugin, and having started a local annotation server, you can edit your project, occasionally run the analyser, and make use of pre-annotated libraries.</p>
</div>
<div class="paragraph">
<p>The analyser produces computed annotations, errors and warnings, which you can of course read from the command line.
It also pushes these errors, warnings, and computed annotations to the annotation server, which is continuously consulted by the highlighter plugin.
So while you&#8217;re working on your project, each time you run the analyser, your editor is updated.
We&#8217;re suggesting that you confirm critical annotations in the source code.
They will get the annotation type <code>VERIFY</code> which is the default for source code read by the analyser, they allow you to 'stabilize' your code with respect to class types like  <code>@Container</code>  or
{e2immutable}.</p>
</div>
<div class="paragraph">
<p>This set-up will get you pretty far, as long as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>your project consists of a single set of source files</p>
</li>
<li>
<p>all the libraries you are using have been pre-annotated.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_full_flow">3.2. Full flow</h3>
<div class="paragraph">
<p>The  <em>e2immu</em>  analyser is set up to read, in order of decreasing priority,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the source code of your project</p>
</li>
<li>
<p>annotated API sources, as a replacement for class files with XML annotations</p>
</li>
<li>
<p>class files and associated XML annotation files from jars, for libraries used in your project</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If your project is or becomes a library for other projects to use, the computed annotations have to be made available to the users of the library:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>for fast turn-around development on your own or in small teams, you can use the analyser run on the library.
This is depicted in <a href="#figure-fast-turnaround">Fast turnaround use of e2immu</a>.
to upload computed annotations to the annotation store, and instruct the analyser on the project consuming the library to consult this store.
For this purpose, the annotation store has the ability to store annotations in user-defined <em>projects</em>; the analyser can read from any such <em>projects</em>.</p>
</li>
<li>
<p>the standard procedure is for the computed annotations to be included in the <code>jar</code> file of the project:
the analyser can directly write <code>annotations.xml</code> files in the resources of your project, one for each package.
This action can take place after the compilation phase and before the packaging phase in you build tool.  <em>e2immu</em>  provides a plugin for Gradle for now.
This flow is depicted in <a href="#figure-annotated-xml-via-gradle">Add annotation.xml files to your jar</a>.</p>
</li>
</ol>
</div>
<div id="figure-fast-turnaround" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/e2immu_fast_turnaround.png" alt="e2immu fast turnaround">
</div>
<div class="title">Figure 2. Fast turnaround use of e2immu</div>
</div>
<div id="figure-annotated-xml-via-gradle" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/e2immu_annotated_xml_via_gradle.png" alt="e2immu annotated xml via gradle">
</div>
<div class="title">Figure 3. Add annotation.xml files to your jar</div>
</div>
<div class="paragraph">
<p>If you are annotating external libraries with  <em>e2immu</em>  annotations, there are two options</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>you can use the <em>external annotations</em> feature of IntelliJ IDEA to create annotations files.
These files are best grouped into a new jar file, on per library, which is to be included in the dependencies of your project.</p>
</li>
<li>
<p>you can use annotated API sources, a kind of Java source file which contains all the declarative aspects of the types you&#8217;ll be using.
These files are quick to create, provide a nice overview, and can be used in combination with the underlying JAR so that you only have to copy those declarations that you want to annotate.
Their main advantage is clarity: all types, fields, and methods <em>relevant to you</em> are close together, with their annotations</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Annotated API sources can be generated by the analyser from jars and XML annotations, presenting only those types, methods and fields that your project is using.</p>
</div>
<div class="paragraph">
<p>Updated annotation files can be generated by the analyser from the combination of annotated API sources and existing annotation files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_analysers_command_line">3.3. The analyser&#8217;s command line</h3>
<div class="paragraph">
<p>The input to the analyser is largely controlled by the following primary locations</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--source=&lt;dir&gt;</code>: the directories where <code>.java</code> sources are to be found.
They can be <code>:</code> or <code>,</code> separated; the argument can also be repeated.
When nothing is specified, the analyser assumes <code>src/main/java</code>.</p>
</li>
<li>
<p><code>--classpath=&lt;cp&gt;</code>: the classpath.
This classpath should include the <code>.class</code> files corresponding to the <code>.java</code> files presented to the analyser.
The format is as parsed by the JDK classpath: colon separated, with wildcards for multipe jar files in the same directory, containing jar files, <code>.class</code> files, or directories.
Multiple <code>--classpath</code> options may be present; all are concatenated.
When nothing is specified, <code>build/classes/java/main:build/resources/main</code> is assumed.</p>
</li>
<li>
<p><code>--jre=&lt;dir&gt;</code>: location of the JRE if a different one from the analyser&#8217;s is to be taken</p>
</li>
<li>
<p><code>--restrict-source=&lt;packages&gt;</code>: restrict the input to the following packages.
The parameter can be comma separated, with wildcards as detailed in the note below.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Maven or Gradle plugin typically takes care of correct values for source input and classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then there are typical options like</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--quiet</code> (short <code>-q</code>): do not write warnings, errors, etc to the standard output.
They are still uploaded when the <code>--upload</code> option is activated.</p>
</li>
<li>
<p><code>--debug=&lt;logtargets&gt;</code>: log targets to activate for debug output. Their names can be found in the class <code>org.e2immu.analyser.util.Logger.LogTarget</code>.</p>
</li>
<li>
<p><code>--ignore-errors</code>: do not end the analyser in an error state when errors have been raised by the analyser.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following options are available to control the output to the annotation server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--upload</code> (short: <code>-u</code>): upload annotations to an annotation server</p>
</li>
<li>
<p><code>--upload-url=&lt;url&gt;</code>, change the default URL which is <code><a href="http://localhost:8281" class="bare">http://localhost:8281</a></code></p>
</li>
<li>
<p><code>--upload-project=&lt;project&gt;</code>, change the default project which is <code>default</code></p>
</li>
<li>
<p><code>--upload-packages=&lt;packages&gt;</code>: a comma-separated list of package names for which annotations are to be uploaded.
The default is to upload all annotations of all types encountered during the parsing process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following options are available to control the output of Annotation XML files written:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--write-annotation-xml</code> (short: <code>-w</code>): create annotation files to be included in the resources, and hence the jar of the project.</p>
</li>
<li>
<p><code>--write-annotation-xml-packages=&lt;packages&gt;</code>: a comma-separated list of package names for which annotation.xml files are to be written.
The default is to write them for all the packages of <code>.java</code> files parsed</p>
</li>
<li>
<p><code>--write-annotation-xml-dir=&lt;directory&gt;</code>: alternative location to write the Xml files.
The value defaults to the resources directory of the project.</p>
</li>
<li>
<p><code>--write-annotated-api</code> (short: <code>-a</code>)</p>
</li>
<li>
<p><code>--write-annotated-api-packages=&lt;packages&gt;</code>: a comma-separated list of package names for which annotated API files are to be written.
The default is to write them for all the packages of <code>.java</code> files parsed.</p>
</li>
<li>
<p><code>--write-annotated-api-dir=&lt;directory&gt;</code>: alternative location to write the annotated API files.
The default is the main directory of the project</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When describing packages, a dot at the end of a package name may be used to indicate the inclusion of all sub-packages.
The wildcard <code>java.</code> includes <code>java.lang</code>, <code>java.io</code>, etc.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_gradle_plugin">3.4. The Gradle plugin</h3>
<div class="paragraph">
<p>The easiest way to use the analyser is via the Gradle plugin.</p>
</div>
<div class="listingblock">
<div class="title">Example of <code>build.gradle</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.analyser</span><span class="delimiter">'</span></span>
}

...

repositories {
    ...
}

dependencies {
   ...
}

e2immu {
    skipProject = <span class="predefined-constant">false</span>
    sourcePackages = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.</span><span class="delimiter">'</span></span>
    jmods = <span class="string"><span class="delimiter">'</span><span class="content">java.base.jmod,java.se.jmod</span><span class="delimiter">'</span></span>
    jre = <span class="string"><span class="delimiter">'</span><span class="content">/Library/Java/JavaVirtualMachines/openjdk-11.0.2.jdk/Contents/Home/</span><span class="delimiter">'</span></span>
    writeAnnotatedAPIPackages = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.</span><span class="delimiter">'</span></span>
    writeAnnotationXMLPackages = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of properties configurable differs slightly from the one of the command line.
Gradle takes care of source and class path.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annotated_apis">4. Annotated APIs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose">4.1. Purpose</h3>
<div class="paragraph">
<p>The modification status of a class often depends on <em>foreign</em> method calls: calls on objects defined outside your own code base.
In some situations, their source code is available, but that need not be the case.
So to build up a fair picture, one could say that the  <em>e2immu</em>  analyser would have to parse all types and methods "from the ground up", and decide on their modification status in an incremental way.
This procedure would be slow and hugely impractical.</p>
</div>
<div class="paragraph">
<p>On top of the incremental problem, APIs often come in the form of an interface without implementation.
Expressing the modification status by hand (the terminology we use is <em>contracting</em>, or writing the contract) is the only way forward.</p>
</div>
<div class="paragraph">
<p>Thirdly, manually annotating APIs can help you <em>override</em> the implied modification status, or any other feature supported by the analyser.
Here are two simple examples why that can come in handy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">List</span>&lt;E&gt; <span class="directive">extends</span> <span class="predefined-type">Collection</span>&lt;E&gt; {
    ...
    <span class="annotation">@Modified</span>
    <span class="type">boolean</span> add(<span class="annotation">@NotNull</span> E e);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we acknowledge that <code>add</code> modifies the list, but we prohibit passing <code>null</code> as an element.
Secondly, we may decide to ignore modifications to the output stream <code>System.out</code>, by writing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">System</span> {

    <span class="annotation">@IgnoreModifications</span>
    <span class="annotation">@NotNull</span>
    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">PrintStream</span> out;

    <span class="annotation">@NotNull</span>
    <span class="annotation">@IgnoreModifications</span>
    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">PrintStream</span> err;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>so that we can still claim that the following method is not modifying:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotModified</span>
<span class="directive">static</span> <span class="type">int</span> square(<span class="type">int</span> x) {
    <span class="type">int</span> result = x*x;
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">The square of </span><span class="delimiter">&quot;</span></span>+x+<span class="string"><span class="delimiter">&quot;</span><span class="content"> is </span><span class="delimiter">&quot;</span></span>+result);
    <span class="keyword">return</span> result;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be clear from these examples, and from the terminology used throughout the rest of the documentation, that we express the modification status, and other aspects of the code, by means of Java annotations.</p>
</div>
<div class="paragraph">
<p>In this section, we describe a practical way of annotating foreign APIs; we call it simply <em>Annotated API</em> files.
The <a href="#annotationxml-files">next section</a> deals with a more compact form, <em>annotation XML</em> files, which are less readable but (maybe) simpler and faster to load.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preparing_annotated_api_files">4.2. Preparing Annotated API files</h3>
<div class="paragraph">
<p>Should we then start to systematically annotate all the libraries that our project uses?
That is one way of approaching the problem; however, because we have a source code analyser at hand, we can easily detect exactly which types, methods, and fields are used by our code.
The analyser&#8217;s command line interpreter (CLI) provides options for generating a template Annotated API file for a whole library, for selected packages, or for exactly those types, methods and fields required.</p>
</div>
<div class="paragraph">
<p>The following Gradle task, taken from the <code>e2immu/annotation-store</code> project, contains the code to produce a single <code>IoVertxCore.java</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Part of <em>build-api.gradle</em> in <em>e2immu/annotation-store</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

task runIoVertxAAPI(<span class="key">type</span>: JavaExec) {
    group = <span class="string"><span class="delimiter">&quot;</span><span class="content">Execution</span><span class="delimiter">&quot;</span></span>
    description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Prepare an AnnotatedAPI file for io.vertx.core</span><span class="delimiter">&quot;</span></span>

    classpath = sourceSets.main.runtimeClasspath
    main = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.analyser.cli.Main</span><span class="delimiter">'</span></span>

    <span class="predefined-type">Set</span>&lt;<span class="predefined-type">File</span>&gt; reducedClassPath = sourceSets.main.runtimeClasspath.toList()
    reducedClassPath += sourceSets.test.runtimeClasspath
    reducedClassPath.removeIf({ f -&gt; f.path.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">build/classes</span><span class="delimiter">&quot;</span></span>)
        || f.path.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">build/resources</span><span class="delimiter">&quot;</span></span>) })

    args(<span class="string"><span class="delimiter">'</span><span class="content">--classpath=</span><span class="delimiter">'</span></span> + reducedClassPath.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">:jmods/java.base.jmod</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">-a</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">--write-annotated-api-packages=io.vertx.core</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">--source=none</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">-d=CONFIGURATION,BYTECODE_INSPECTOR</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task can be run with the command <code>./gradlew -b build-api.gradle runIoVertxAAPI</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_annotated_api_file_format">4.3. The Annotated API file format</h3>
<div class="paragraph">
<p>Annotated API files are standard Java files, they will be inspected by a standard Java parser, so all normal syntax rules need to be followed.
They deviate in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The primary types become sub-types of a primary type named after the package.</p>
</li>
<li>
<p>To ensure that there is no clash with preloaded primary types, they have a dollar <code>$</code> suffix.</p>
</li>
<li>
<p>A string constant, <code>PACKAGE_NAME</code>, specifies the package to which 'dollar types' are transferred.</p>
</li>
<li>
<p>All types become classes, all methods return a default value.
Actually, none of the decorations to a type, method, or field matter, as long as the analyser can identify the structure uniquely.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This excerpt from the annotated API file for <code>java.util</code> used by the tests in the analyser, shows what this looks like:</p>
</div>
<div class="listingblock">
<div class="title">Start of the <em>JavaUtil.java</em> annotated API file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">JavaUtil</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PACKAGE_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">static</span> <span class="type">class</span> <span class="class">Enumeration</span><span class="error">$</span> {
        <span class="type">boolean</span> hasMoreElements() { <span class="keyword">return</span> <span class="predefined-constant">false</span>; }
        E nextElement() { <span class="keyword">return</span> <span class="predefined-constant">null</span>; }
        <span class="predefined-type">Iterator</span>&lt;E&gt; asIterator() { <span class="keyword">return</span> <span class="predefined-constant">null</span>; }
    }

    <span class="directive">static</span> <span class="type">class</span> <span class="class">Map</span><span class="error">$</span> {
        <span class="directive">static</span> <span class="type">class</span> <span class="class">Entry</span> {
            K getKey() { <span class="keyword">return</span> <span class="predefined-constant">null</span>; }
            V getValue() { <span class="keyword">return</span> <span class="predefined-constant">null</span>; }
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once all relevant types, methods and fields can be written, they can be annotated, as in:</p>
</div>
<div class="listingblock">
<div class="title">A second part of the <em>JavaUtil.java</em> annotated API file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">JavaUtil</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PACKAGE_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util</span><span class="delimiter">&quot;</span></span>;

    ...

    <span class="annotation">@Container</span>
    <span class="comment">// this is not in line with the JDK, but we will block null keys!</span>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Collection</span><span class="error">$</span>&lt;E&gt;  {

        <span class="type">boolean</span> add<span class="error">$</span>Postcondition(E e) { <span class="keyword">return</span> contains(e); }
        <span class="annotation">@Modified</span>
        <span class="type">boolean</span> add(<span class="annotation">@Dependent1</span> <span class="annotation">@NotNull</span> E e) { <span class="keyword">return</span> <span class="predefined-constant">true</span>; }

        <span class="annotation">@Independent</span>
        <span class="type">boolean</span> addAll(<span class="annotation">@Dependent1</span> <span class="annotation">@NotNull1</span> java.util.Collection&lt;? <span class="directive">extends</span> E&gt; collection) {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        <span class="directive">static</span> <span class="type">boolean</span> clear<span class="error">$</span>Clear<span class="error">$</span>Size(<span class="type">int</span> i) { <span class="keyword">return</span> i == <span class="integer">0</span>; }
        <span class="annotation">@Modified</span>
        <span class="type">void</span> clear() { }

        <span class="directive">static</span> <span class="type">boolean</span> contains<span class="error">$</span>Value<span class="error">$</span>Size(<span class="type">int</span> i, <span class="predefined-type">Object</span> o, <span class="type">boolean</span> retVal) {
            <span class="keyword">return</span> i != <span class="integer">0</span> &amp;&amp; retVal;
        }
        <span class="annotation">@NotModified</span>
        <span class="type">boolean</span> contains(<span class="annotation">@NotNull</span> <span class="predefined-type">Object</span> object) { <span class="keyword">return</span> <span class="predefined-constant">true</span>; }

        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also on display here are <a href="#companion-methods">Companion methods</a>, static methods describing either how the state of a <code>Collection</code> instance changes after a modifying method call, or certain edge cases can be resolved using this state information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotation_types">4.4. Annotation types</h3>
<div class="paragraph">
<p>All  <em>e2immu</em>  annotations have a parameter of the enum type <code>AnnotationType</code>, which takes 4 different values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">VERIFY</dt>
<dd>
<p>this is the default value inserted when parsing Java code.
This corresponds to the standard use of  <em>e2immu</em>  annotations: normally the analyser will compute them for you, but you may want to assert their presence.</p>
</dd>
<dt class="hdlist1">VERIFY_ABSENT</dt>
<dd>
<p>mostly for debugging: insert in the Java code by hand to make sure the analyser does not end up computing this assertion for you.</p>
</dd>
<dt class="hdlist1">COMPUTED</dt>
<dd>
<p>added to annotations inserted by the analyser</p>
</dd>
<dt class="hdlist1">CONTRACT</dt>
<dd>
<p>added to annotations inserted when parsing annotation XMLs or annotated APIs.
This type indicates that a value has not been computed, but stipulated by the user.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The list of available annotations can be found <a href="#list-of-annotations">here</a>.
In Annotated API files, CONTRACT is the default type, and needs not be specified.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_collections_framework">4.5. The Collections framework</h3>
<div class="sect3">
<h4 id="_not_null">4.5.1. Not null</h4>
<div class="paragraph">
<p>We strongly object to the use of <code>null</code> in sets and maps&#8201;&#8212;&#8201;note that this can be valid point of view even if one embraces <code>null</code> as a valuable concept denoting <em>absence of a value</em>.
It is our opinion that one should not store <em>absence of a value</em> in a set, nor should one use <em>absence of a value</em> as the key in a map.
The same does not hold for arrays, and should therefore not be so important for lists.
But then, consistency prevails.
We are happy with <code>null</code> in arrays, but not in standard collections.</p>
</div>
<div class="paragraph">
<p>Consequently, our <code>java.util</code> annotated APIs are littered with  <code>@NotNull</code>  and {nn1} annotations.
Note that we have not equipped  <em>e2immu</em>  with a  <code>@NotNull</code>  annotation on types.
When a collection comes in as a parameter, and the collection should be present,  <code>@NotNull</code>  is the obvious choice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">int</span> combinedSize(<span class="annotation">@NotNull</span> <span class="predefined-type">Set</span>&lt;T&gt; set) {
    <span class="keyword">return</span> someValue + set.size();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of {nn1} is rather patchy at the moment, focusing on arrays, functional interfaces, and iteration over collections, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> method(<span class="annotation">@NotNull1</span> <span class="predefined-type">Set</span>&lt;T&gt; set) {
    <span class="keyword">for</span>(T t: set) {
        <span class="keyword">if</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>.equals(t.toString)) { <span class="comment">// forces t to be @NotNull, set to be @NotNull1</span>
            ...
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_iterating_over_maps">4.5.2. Iterating over maps</h4>
<div class="paragraph">
<p>Interestingly, <code>Map.Entry</code> has a <code>setValue()</code> method which allows the developer to change the value of a mapping during iteration.
As a consequence, we annotate the mutable type as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span>
<span class="annotation">@Independent1</span>
<span class="type">interface</span> <span class="class">Entry</span>&lt;K, V&gt; {
    <span class="annotation">@NotNull</span>
    K getKey();

    <span class="annotation">@NotNull</span>
    V getValue();

    <span class="annotation">@Modified</span>
    V setValue(V v);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>Map.entrySet()</code> returns a set of entries, which is a <em>view</em> on the map, indicating that the set is backed by the map, and changes to the set imply changes to the map.
We must therefore annotate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span> <span class="comment">// and implicitly @Dependent</span>
<span class="type">interface</span> <span class="class">Map</span><span class="error">$</span>&lt;K, V&gt; {
   ...

   <span class="comment">// implicitly @Dependent</span>
   <span class="annotation">@NotNull1</span>
   <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Map</span>.Entry&lt;K, V&gt;&gt; entrySet();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use <code>entrySet()</code> in a for-each construct, we must annotate the interface <code>Iterable</code>, which is extended by <code>Collection</code> and therefore also by <code>Set</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span> <span class="comment">// and implicitly @Dependent</span>
<span class="type">interface</span> <span class="class">Iterable</span><span class="error">$</span>&lt;T&gt; {
    <span class="annotation">@NotModified</span>
    <span class="type">void</span> forEach(<span class="annotation">@NotNull</span> <span class="annotation">@Independent1</span> Consumer&lt;? <span class="local-variable">super</span> T&gt; action);

    <span class="comment">// implicitly @Dependent, `Iterator` has `remove()`</span>
    <span class="annotation">@NotNull</span>
    <span class="predefined-type">Iterator</span>&lt;T&gt; iterator();

    <span class="annotation">@NotNull</span>
    <span class="annotation">@Independent1</span>
    Spliterator&lt;T&gt; spliterator();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we note that <code>Iterator</code> has a <code>remove()</code> operation, which makes every iterator dependent on its iterable source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span>
<span class="annotation">@Independent1</span>
<span class="type">interface</span> <span class="class">Iterator</span><span class="error">$</span>&lt;T&gt; {
    <span class="annotation">@Modified</span>
    <span class="keyword">default</span> <span class="type">void</span> forEachRemaining(<span class="annotation">@NotNull</span> <span class="annotation">@Independent1</span> Consumer&lt;? <span class="local-variable">super</span> T&gt; action) {
    }

    <span class="annotation">@Modified</span>
    <span class="type">boolean</span> hasNext();

    <span class="annotation">@Modified</span> <span class="comment">// implicitly @Independent1</span>
    T next();

    <span class="annotation">@Modified</span>
    <span class="type">void</span> remove();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this background, we can analyse the dependencies between <code>entry</code> and <code>map</code> in the common construct</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">for</span>(Entry&lt;K, V&gt; entry: map.entrySet()) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is equivalent to the more elaborate construct</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Iterator</span>&lt;Entry&lt;K, V&gt;&gt; iterator = map.entrySet().iterator();
<span class="keyword">while</span>(iterator.hasNext()) {
    Entry&lt;K, V&gt; entry = iterator.next();
    K key = entry.getKey();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both methods <code>entrySet()</code> and <code>iterator()</code> are {dependent}, so we start off with local variable <code>iterator</code> linked to <code>map</code>.
Modifications to the iterator (e.g., by calling the <code>remove()</code> method), will modify the map.</p>
</div>
<div class="paragraph">
<p>The <code>entry</code> is obtained by calling the method <code>next()</code> on the iterator, which is marked {independent1}.
This means that the method result is linked to the hidden content of the iterator, which consists of <code>Entry</code> objects.
These <code>Entry</code> objects, however, are not part of the hidden content of <code>Map</code>: only objects of types <code>K</code> and <code>V</code> have that property.
Because the <code>Entry</code> objects have been obtained from <code>Map</code> in a {dependent} way, and <code>Map</code> is mutable, we equate changes to an <code>Entry</code> object to changes to the map.</p>
</div>
<div class="paragraph">
<p>In a picture, the situation looks like:</p>
</div>
<div id="foreach-asis" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/forEach_asIs.png" alt="forEach asIs">
</div>
<div class="title">Figure 4. Current situation, entry to map</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The links are: {independent1} from <code>entry</code> to <code>iterator</code>, {dependent} from <code>iterator</code> to the entry set, and {dependent} from the entry set to the <code>map</code>.
Because <code>entry</code> is hidden in <code>iterator</code>, and <code>iterator</code> is dependent on map <code>map</code>, and <code>entry</code> is not of a hidden type in <code>map</code>, and it is mutable, we link <code>entry</code> to <code>map</code> in a {dependent} way.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Suppose we tell the analyser that the user can never use the <code>setValue</code> method of <code>Entry</code>.
Then, <code>Entry</code> becomes {e2container}.
Because it is now immutable, <code>entry</code> can only be content linked to <code>map</code>, i.e., at the {independent1} level.
This is depicted by:</p>
</div>
<div id="foreach-nosenvalue" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/forEach_noSetValue.png" alt="forEach noSetValue">
</div>
<div class="title">Figure 5. No setValue() method, entry to map</div>
</div>
<div class="paragraph">
<p>Alternatively, we could forbid the modification of entry sets, e.g., by contracting <code>entrySet()</code> to return an {e2container} object.
(Calling a modifying method on such an object will cause  <em>e2immu</em>  to raise an error.) Then, <code>iterator</code>, still linked to the entry set, remains linked to the mutable <code>map</code>: while the <em>set</em> is immutable, the non-hidden <code>Entry</code> objects are not.
As a consequence, <code>Entry</code> objects remain linked to the map, because the previous rule still applies.</p>
</div>
<div id="foreach-entry" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/forEach_immutableSet.png" alt="forEach immutableSet">
</div>
<div class="title">Figure 6. entrySet() immutable, entry to map</div>
</div>
<div class="paragraph">
<p>It would be safer to forbid the use of the <code>remove()</code> method in the iterator at the same time.
However, this does not change the linking situation:</p>
</div>
<div id="foreach-entrynoremove" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/forEach_immutableSetAndNoRemove.png" alt="forEach immutableSetAndNoRemove">
</div>
<div class="title">Figure 7. entrySet() immutable, and no remove() method, entry to map</div>
</div>
<div class="paragraph">
<p>Finally, we remark that only changing the <code>remove()</code> method does not change the linking situation between <code>Entry</code> and <code>Map</code>.</p>
</div>
<div id="foreach-noremove" class="imageblock">
<div class="content">
<img src="/Users/bnaudts/git/e2immu-documentation/src/docs/asciidoc/images/forEach_noRemove.png" alt="forEach noRemove">
</div>
<div class="title">Figure 8. No remove() method, entry to map</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotationxml-files">5. Annotation XML files</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_visualising_immutability">6. Visualising immutability</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="demo-project">7. The annotation store as a demo project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section assumes you have installed the analyser and its supporting jars, as described in <a href="#installing">Installing e2immu</a>.</p>
</div>
<div class="paragraph">
<p>Next to playing a role in the communication between the IntelliJ plugin and the analyser, the annotation store serves as a demo project for the analyser.
In its <code>build.gradle</code> file, the relevant lines to run the analyser are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    ...
    id <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.analyser</span><span class="delimiter">'</span></span>
}
...
e2immu {
    debug = <span class="string"><span class="delimiter">&quot;</span><span class="content">OUTPUT</span><span class="delimiter">&quot;</span></span> <span class="comment">//INSPECT,BYTECODE_INSPECTOR,ANALYSER,DELAYED&quot;</span>
    jmods = <span class="string"><span class="delimiter">'</span><span class="content">java.base.jmod,java.logging.jmod</span><span class="delimiter">'</span></span>
    sourcePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.e2immu.kvstore</span><span class="delimiter">&quot;</span></span>
    readAnnotatedAPIPackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.e2immu.kvstoreaapi</span><span class="delimiter">&quot;</span></span>
    writeAnnotationXML = <span class="predefined-constant">true</span>
    writeAnnotationXMLPackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.e2immu.</span><span class="delimiter">&quot;</span></span>
    upload = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the analyser, as a Gradle plugin, is only available in your local Maven repository, the following lines need to be present in <code>settings.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    repositories {
        mavenLocal()
        ...
    }
    resolutionStrategy {
        eachPlugin {
            <span class="keyword">if</span> (requested.id.namespace == <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu</span><span class="delimiter">'</span></span>) {
                useModule(<span class="string"><span class="delimiter">'</span><span class="content">org.e2immu:gradle-plugin:0.1.2</span><span class="delimiter">'</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the analyser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew e2immu-analyser</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should "fail" with 2 errors and 4 warnings.
If you have not started an annotation store (yet), you should also see an <code>IOException</code> warning you that uploading to the annotation store failed.</p>
</div>
<div class="paragraph">
<p>The <code>debug</code> options to <code>e2immu</code> listed above activate only the <code>OUTPUT</code> debug logger, which writes out the sources enriched with all annotations computed by the analyser.
Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew e2immu-analyser --debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>to find them, obviously among a lot of other debug output.</p>
</div>
<div class="paragraph">
<p>Next to the <code>build.gradle</code> build file, there is a second one, <code>build-api.gradle</code>.
It provides two tasks, <code>runIoVertxInspected</code> and <code>runIoVertxUsage</code>, which run the analyser via its command line interpreter rather than the Gradle plugin.
Their primary goal is to produce templates for annotated API files.
The former contains the option <code>--write-annotated-api=INSPECTED</code>, the latter the option <code>--write-annotated-api=USAGE</code>.</p>
</div>
<div class="paragraph">
<p>Executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">./gradlew -b build-api.gradle runIoVertxUsage</code></pre>
</div>
</div>
<div class="paragraph">
<p>runs the analyser without annotated API sources, which produces a lot of warnings, but also writes template files in the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">build/annotatedAPIs/org/e2immu/kvstoreaapi/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference"><em>Reference</em></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_concepts">8. Concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concept-modified">8.1. Modification</h3>
<div class="paragraph">
<p>Modification of parameters is seen as any modification to the entire object graph of the parameter.</p>
</div>
<div class="paragraph">
<p>Modification of a field is seen as a modification to the accessible content of the field, i.e., as a modification which happens explicitly inside the type of the field.</p>
</div>
<div class="paragraph">
<p>A method is modifying when it makes a modification to any of the fields of the type of the method.
Modifications to a field of a different type within the same primary type <mark>TODO</mark>.</p>
</div>
<div class="paragraph">
<p>A modification to a (necessarily non-private) foreign static field is called a <em>static side effect</em>.
Type which has methods which make static side effects, is marked with  <code>@StaticSideEffects</code> .
Static side effect marking can be disabled by annotating a static, non-private field with  <code>@IgnoreModifications</code> .</p>
</div>
</div>
<div class="sect2">
<h3 id="concept-hidden-content">8.2. Hidden content</h3>
<div class="paragraph">
<p>We divide the object graph of the fields into an <em>accessible</em> part, and a <em>hidden part</em>.
The <em>depth</em> of the object graph plays the primary role in separating both parts: most implementations do not access <em>all</em> types that are theoretically reachable from the fields.
Secondly, we note that every class <code>C</code> that can be sub-classed, i.e., which has not been marked <code>final</code>, and every interface <code>I</code>, can have a subclass or implementation <code>S</code> which has fields that are outside its reach.
So when faced with the formal type <code>C</code> or <code>I</code>, a concrete object of type <code>S</code> may be present.
This object carries a part hidden to the methods and field accessors of <code>C</code> or <code>I</code>.</p>
</div>
<div class="paragraph">
<p>We speak of the <em>hidden content</em> of the types when we refer to the hidden part of its fields' object graph.
Hidden contents are omni-present in Java.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The core concept of practical immutability is that modifications to the hidden content of a type are irrelevant to that type.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In  <em>e2immu</em> , the hidden content of a type <code>T</code> is computed on a type-by-type basis: it consists of a set of parameterized types <code>H1</code>, &#8230;&#8203;, <code>Hn</code>.
A type <code>H</code> belongs to the hidden content of <code>T</code> when it is part of the object graph of the fields, and it is not <em>explicit</em> in <code>T</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The underlying concept of being explicit is that the type cannot be replaced by an unbound type parameter, or <code>java.lang.Object</code> (JLO), to achieve identical semantics inside <code>T</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Formally, a type <code>E</code> is explicit in <code>T</code> when either</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>it is instantiated, e.g., <code>&#8230;&#8203; = new E(&#8230;&#8203;)</code> occurs in one of the statements of <code>T</code>; the exception to the rule is JLO; note that the presence of a lambda implies the creation of in instance of the functional interface type;</p>
</li>
<li>
<p>a method is called on it, e.g., when <code>e</code> is of type <code>E</code>, then <code>e.someMethod(&#8230;&#8203;)</code> occurs in the statements of <code>T</code>; the exceptions to the rule are JLO&#8217;s methods;</p>
</li>
<li>
<p>one of its fields is accessed, e.g., when <code>e</code> is of type <code>E</code>, then <code>e.someField</code> occurs in the statements of <code>T</code>;</p>
</li>
<li>
<p>one of its extended types is explicit in <code>T</code>; this rule does not apply to JLO itself;</p>
</li>
<li>
<p>the type occurs as the type of an object forced to comply with some type restriction:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>as an argument in a method or constructor call, unless the formal parameter of that method or constructor is JLO, or is an unbound type parameter;</p>
</li>
<li>
<p>as the formal expression type <code>E</code> of a <code>return</code> statement in a method <code>m</code> of <code>T</code> returning a type different from JLO and an unbound type parameter;</p>
</li>
<li>
<p>as the iterable&#8217;s formal return type <code>E</code> in a <code>for(X x: e)</code> construct;</p>
</li>
<li>
<p>as the selector&#8217;s formal type in a <code>switch(e)</code> statement;</p>
</li>
<li>
<p>as the formal expression type <code>E</code> of a cast argument <code>x = (X)e</code></p>
</li>
<li>
<p>as the formal expression type <code>E</code> of an <code>e instanceof X</code> or <code>e instanceof X x</code> expression</p>
</li>
</ol>
</div>
</li>
<li>
<p>it occurs as an explicit type in a statement of <code>T</code>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>as the exception type in a <code>catch(E e)</code> clause;</p>
</li>
<li>
<p>as the type of a cast, e.g., <code>x = (E)e</code>;</p>
</li>
<li>
<p>as the type of an <code>instanceof</code> expression, with or without pattern, as in <code>x instanceof E e</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the type <code>S</code> extends the type <code>C</code>, then types which are transparent in <code>C</code> may not be transparent in <code>S</code> anymore.
The type <code>S</code> can also introduce new transparent types.
However, a type cannot be transparent in <code>S</code> and explicit in <code>C</code>: all explicit types of <code>C</code> are also explicit in <code>S</code>.</p>
</div>
<div class="paragraph">
<p>If a type <code>N</code> is a nested class of an enclosing type <code>E</code>, then all explicit types of <code>N</code> are also explicit in <code>E</code>.
A type <code>E</code> and its inner class <code>I</code> (nested, not static) share the same set of transparent and explicit types.</p>
</div>
<div class="paragraph">
<p>For practical reasons, <code>java.lang.Object</code>, <code>java.lang.String</code> and <code>java.lang.Class</code> are always explicit.</p>
</div>
</div>
<div class="sect2">
<h3 id="concept-containers">8.3. Containers</h3>
<div class="paragraph">
<p>A type is a container when only private methods or private constructors modify their parameters.
To the outside world, all parameters must be  <code>@NotModified</code>.</p>
</div>
<div class="paragraph">
<p>When a modifying method is called on a parameter, but this modification is semantically deemed to be irrelevant, then  <code>@IgnoreModifications</code>  can be added to the parameter.
This is implicitly the case when the parameter is of one of the abstract types in <code>java.util.function</code>, such as <code>Function</code>, <code>Consumer</code>, etc.
The modifications caused by their concrete implementations are typically outside the scope of the type.
The typical example of this situation is the <code>forEach</code> method of the <code>java.util.Collection</code> classes: iterating over the collection should be non-modifying, and modifications to the hidden content are semantically irrelevant to the collection.</p>
</div>
</div>
<div class="sect2">
<h3 id="concept-linking">8.4. Linking and independence</h3>
<div class="paragraph">
<p>Two variables are linked when a modification in one may imply a modification in the other.
We differentiate between modifications to the accessible content (normal <em>linking</em>), and modifications to the hidden content (<em>hidden content linking</em>).</p>
</div>
<div class="paragraph">
<p>Linking typically occurs when the object graphs of the variables (partially) overlaps.</p>
</div>
<div class="paragraph">
<p>A method is <em>dependent</em> when one of the fields of the type links to the return value of the method.
A constructor or method parameter is <em>dependent</em> when it links to one of the fields of the type.</p>
</div>
<div class="paragraph">
<p>A method or parameter is independent when it is not dependent.
However, given the possibility of hidden content linking, we differentiate between different <em>levels</em> of independence.
When the hidden content of the field being linked to the return value or parameter is mutable or level 1 immutable, we speak of level 1 independence, and mark with {independent1}.
When the hidden content is level 2 immutable, we speak of level 2 independence, and write <code>@Independent1(level=2)</code>.
When no modifications are possible at all, the hidden content must be recursively immutable, and we speak of independence, marked as  <code>@Independent</code> .</p>
</div>
<div class="paragraph">
<p>The computation of linking follows the rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>after an assignment <code>a = b</code>, the variable <code>a</code> is linked to the variable <code>b</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The computation of hidden content linking is similar but not quite identical:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>after an assignment <code>a = b</code>, the variable <code>a</code> is hidden content linked to the variable <code>b</code></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_factory_methods">8.4.1. Factory methods</h4>
<div class="paragraph">
<p>A <em>factory method</em> is a static method in type <code>T</code> returning a (newly created) element of this type.
In factory methods, we compute linking and content linking between the parameters and the return value, ignoring the fields.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_immutability">8.5. Immutability</h3>
<div class="sect3">
<h4 id="concept-e1immutable">8.5.1. Level 1 immutable</h4>
<div class="paragraph">
<p>A field is called <em>effectively final</em> when it receives a value during the construction phase of the object.
There are two situations: either it is decorated with the modifier <code>final</code>, or it is set in a constructor, or a method only (indirectly) accessible from the constructors.
We mark effectively final fields with  <code>@Final</code> ; fields without this property are called <em>variable</em> and marked {variable}.</p>
</div>
<div class="paragraph">
<p>A type is <em>level 1 immutable</em> when all its fields are effectively final.
No distinction is made between static and instance fields.</p>
</div>
<div class="paragraph">
<p>A type is <a href="#concept-eventual">eventually</a> level 1 immutable when after executing a marked method, the fields become effectively final.
This transition is best understood as the removal of a number of methods, marked either  <code>@Mark</code>  or  <code>@Only</code>  with parameter <code>before</code>, which make the field variable.
The mark is annotated in the  <code>@Final</code>  annotation, as <code>@Final(after="mark")</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="concept-e2immutable">8.5.2. Level n immutable</h4>
<div class="paragraph">
<p>A type is level <em>n</em>, <em>n&gt;1</em>, immutable when</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>it is level 1 immutable, i.e., all its fields are effectively final</p>
</li>
<li>
<p>all fields are not modified</p>
</li>
<li>
<p>all fields are either private, or at least of level 2 immutable type</p>
</li>
<li>
<p>no parameters of non-private constructors and non-private methods are dependent of the fields, and no return values of non-private methods are dependent on the fields.</p>
</li>
<li>
<p>the hidden content of the type is mutable or level 1 immutable, when <em>n=2</em>, and level <em>n-1</em> immutable otherwise.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>No distinction is made between static and instance fields.</p>
</div>
<div class="paragraph">
<p>A type is <a href="#concept-eventual">eventually</a> level <em>n</em> immutable when after executing a marked method, the fields become effectively final and or not modified.</p>
</div>
</div>
<div class="sect3">
<h4 id="concept-recursively-immutable">8.5.3. Recursive immutability</h4>
<div class="paragraph">
<p>A type is <em>recursively immutable</em> when it is level 2 immutable, with rule 5 modified to state that its hidden content is also recursively immutable.</p>
</div>
<div class="paragraph">
<p>A recursively immutable type is <em>deeply</em> immutable, i.e., no part of its fields' object graph can be modified.</p>
</div>
<div class="paragraph">
<p>A direct consequence of the definition is that any level 2 immutable type which holds recursively immutable fields only, is again recursively immutable.
The following types are recursively immutable, and form the basis of the recursion which allows you to compose more of them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.lang.Object</code></p>
</li>
<li>
<p>the primitive types, such as <code>int</code>, <code>long</code>, &#8230;&#8203;</p>
</li>
<li>
<p><code>java.lang.Integer</code>, <code>java.lang.Long</code>, &#8230;&#8203; the boxed versions of the primitives <code>int</code>, <code>long</code> &#8230;&#8203;</p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>java.lang.Class</code>, whose object graph covers a large amount of other types such as</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_independence_of_a_type">8.5.4. Independence of a type</h4>
<div class="paragraph">
<p>A recursively immutable type is fully independent, at all times.
As such, it is never explicitly marked  <code>@Independent</code> .</p>
</div>
<div class="paragraph">
<p>A level 2 immutable type allows for level 1 independence; a level <em>n</em> immutable type allows for level <em>n-1</em> independence.
Again, no explicit annotation is necessary.
Obviously, a parameter or return value need not be linked to the fields, so it can be  <code>@Independent</code> .</p>
</div>
<div class="paragraph">
<p>Dependence is only possible when the type is at most level 1 immutable; i.e., its accessible content is assignable or at least modifiable.
But dependence is not a necessity.</p>
</div>
<div class="paragraph">
<p>We define the independence of a type as the minimum of the independence values of its return values and parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="technical-dynamic-type-annotations">8.5.5. Dynamic type annotations</h4>

</div>
</div>
<div class="sect2">
<h3 id="concept-eventual">8.6. Eventual immutability</h3>

</div>
<div class="sect2">
<h3 id="_miscellaneous">8.7. Miscellaneous</h3>
<div class="sect3">
<h4 id="concept-constant">8.7.1. Constants</h4>
<div class="paragraph">
<p>Java literals are constants.
An instance of a type whose effectively final fields have only been assigned literal values, is a constant instance.
Typical examples of a constant instances are found in parameterized <code>enum</code> fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="concept-statement-time">8.7.2. Statement time</h4>
<div class="paragraph">
<p>Technically important for variable fields (<a href="#concept-e1immutable">Level 1 immutable</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="concept-singleton">8.7.3. Singleton classes</h4>

</div>
<div class="sect3">
<h4 id="concept-utility-class">8.7.4. Utility classes</h4>
<div class="paragraph">
<p>A class which is at the same time eventually level 2 immutable, and cannot be instantiated.</p>
</div>
<div class="paragraph">
<p>The level 2 immutability ensures that the (static) fields are sufficiently immutable.
The fact that it cannot be instantiated is verified by</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the fact that all constructors should be private;</p>
</li>
<li>
<p>there should be at least one private constructor;</p>
</li>
<li>
<p>no method or field can use the constructors to instantiate objects of this type.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="concept-extension-class">8.7.5. Extension classes</h4>
<div class="paragraph">
<p>An extension class is an eventually final type whose static methods all share the same type of first parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="concept-finalizer">8.7.6. Finalizers</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analyser_details">9. Analyser details</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preconditions">9.1. Preconditions</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="_instance_state">9.2. Instance state</h3>

</div>
<div class="sect2">
<h3 id="companion-methods">9.3. Companion methods</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_annotations">10. Overview of annotations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="list-of-annotations">10.1. List of annotations</h3>
<div class="paragraph">
<p>For each of the annotations, we answer a couple of standard questions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Basic</dt>
<dd>
<p>is this an annotation you definitely should understand?</p>
</dd>
<dt class="hdlist1">Immu</dt>
<dd>
<p>is this annotation part of the immutability concept of the analyzer?</p>
</dd>
<dt class="hdlist1">Contract</dt>
<dd>
<p>will you manually insert this annotation often in interfaces?</p>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<p>does the annotation occur on types?</p>
</dd>
<dt class="hdlist1">Field</dt>
<dd>
<p>does the annotation occur on (static) fields?</p>
</dd>
<dt class="hdlist1">Method</dt>
<dd>
<p>does the annotation occur on methods and constructors?</p>
</dd>
<dt class="hdlist1">Parameter</dt>
<dd>
<p>does the annotation occur on parameters?</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This classification hopefully helps to see the wood for the trees in the long list.</p>
</div>
<div class="sect3">
<h4 id="allowsInterrupt-annotation">10.1.1. @AllowsInterrupt</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Contract-only annotation indicating that this method or constructor increases the statement time (<a href="#concept-statement-time">Statement time</a>), in other words, it allows the execution to be interrupted.</p>
</div>
<div class="paragraph">
<p>Default value of the annotation is true.
Methods can be annotated with <code>@AllowsInterrupt(false)</code> to explicitly mark that they do not interrupt.</p>
</div>
<div class="paragraph">
<p>External methods not annotated will not interrupt.</p>
</div>
</div>
<div class="sect3">
<h4 id="beforeMark-annotation">10.1.2. @BeforeMark</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Annotation computed when an eventually immutable type is guaranteed to be in its <em>before</em> state, i.e., none of the marked methods have been called yet.
As a dynamic type annotation (<a href="#technical-dynamic-type-annotations">Dynamic type annotations</a>), it is the opposite of {e1immutable},
{e2immutable}, or its container variants {e1container}, {e2container}, {ercontainer}.
They guarantee that an eventually immutable object is in its <em>after</em> state, i.e., a marked method has been called, and the object has become immutable.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="constant-annotation">10.1.3. @Constant</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>The analyser emits this annotation when a field has a constant final value, or a method returns a constant value.
Its primary purpose is to help debug the analyser.
More details in <a href="#concept-constant">Constants</a>.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>In this simple example, an <code>enum</code> constant is returned by the <code>highest</code> method:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ImmutableContainer</span>
<span class="directive">public</span> <span class="type">enum</span> Enum_3 {
    ONE(<span class="integer">1</span>), TWO(<span class="integer">2</span>), THREE(<span class="integer">3</span>);

    <span class="directive">public</span> <span class="directive">final</span> <span class="type">int</span> cnt;

    Enum_3(<span class="type">int</span> cnt) {
        <span class="local-variable">this</span>.cnt = cnt;
    }

    <span class="annotation">@Constant</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">THREE</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="directive">static</span> Enum_3 highest() {
        <span class="keyword">return</span> THREE;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="container-annotation">10.1.4. @Container</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>The analyser computes this essential annotation for types which do not modify the parameters of their constructors and non-private methods.
See <a href="#concept-containers">Containers</a> for an in-depth discussion.</p>
</dd>
<dt class="hdlist1">Group</dt>
<dd>
<p>The opposite is {mutableModifiesArguments} if the type has {variable} fields, or {e1immutable} if all the type&#8217;s fields are effectively final.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The following examples present containers: <a href="#constant-annotation">@Constant</a>, <a href="#dependent-annotation">@Dependent</a>, <a href="#e1container-annotation">@E1Container</a>.
Non-containers are in <a href="#e1immutable-annotation">@E1Immutable</a> and <a href="#mutableModifiesArguments-annotation">@MutableModifiesArguments</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="dependent-annotation">10.1.5. @Dependent</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Annotation used to indicate that the type&#8217;s fields <a href="#concept-linking">link</a> to the non-private method&#8217;s parameter or return value, or the non-private constructor&#8217;s parameters.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This annotation is the default value in the {dependent}, {independent1},  <code>@Independent</code>  sequence; hence, it is never explicitly generated by the analyser.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Group</dt>
<dd>
<p>Its opposites are is  <code>@Independent</code>  (no linking is possible) and {independent1} (content linking only).</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The assignment of a mutable set to a field typically causes a dependency:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">DependentSet</span>&lt;<span class="predefined-type">String</span>&gt; {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; set;

    <span class="directive">public</span> DependentSet(<span class="annotation">@Dependent</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; set) {
        <span class="local-variable">this</span>.set = set;
    }

    <span class="annotation">@Dependent</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getSet() {
        <span class="keyword">return</span> set;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A similar example is in <a href="#e1immutable-annotation">@E1Immutable</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="e1container-annotation">10.1.6. @E1Container</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation is a short-hand for the combination of {e1immutable} and  <code>@Container</code> , as described in <a href="#concept-e1immutable">Level 1 immutable</a> and <a href="#concept-containers">Containers</a>.</p>
</dd>
<dt class="hdlist1">Group</dt>
<dd>
<p>This annotation sits in between {mutableModifiesArguments},  <code>@Container</code>  and {e2container}.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>In the following example of an eventually level 1 immutable type, the field <code>j</code> remains variable until the user of the class calls <code>setPositiveJ</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example of an eventually @E1Container type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@E1Container</span>(after = <span class="string"><span class="delimiter">&quot;</span><span class="content">j</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">EventuallyE1Immutable_2_M</span> {

    <span class="annotation">@Modified</span>
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Integer</span>&gt; integers = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();

    <span class="annotation">@Final</span>(after = <span class="string"><span class="delimiter">&quot;</span><span class="content">j</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="type">int</span> j;

    <span class="annotation">@Modified</span>
    <span class="annotation">@Only</span>(after = <span class="string"><span class="delimiter">&quot;</span><span class="content">j</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">boolean</span> addIfGreater(<span class="type">int</span> i) {
        <span class="keyword">if</span> (<span class="local-variable">this</span>.j &lt;= <span class="integer">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Not yet set</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (i &gt;= <span class="local-variable">this</span>.j) {
            integers.add(i);
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="annotation">@NotModified</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Integer</span>&gt; getIntegers() {
        <span class="keyword">return</span> integers;
    }

    <span class="annotation">@NotModified</span>
    <span class="directive">public</span> <span class="type">int</span> getJ() {
        <span class="keyword">return</span> j;
    }

    <span class="annotation">@Modified</span>
    <span class="annotation">@Mark</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">j</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setPositiveJ(<span class="type">int</span> j) {
        <span class="keyword">if</span> (j &lt;= <span class="integer">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>();
        <span class="keyword">if</span> (<span class="local-variable">this</span>.j &gt; <span class="integer">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Already set</span><span class="delimiter">&quot;</span></span>);

        <span class="local-variable">this</span>.j = j;
    }

    <span class="annotation">@Modified</span>
    <span class="annotation">@Only</span>(before = <span class="string"><span class="delimiter">&quot;</span><span class="content">j</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNegativeJ(<span class="type">int</span> j) {
        <span class="keyword">if</span> (j &gt; <span class="integer">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>();
        <span class="keyword">if</span> (<span class="local-variable">this</span>.j &gt; <span class="integer">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Already set</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.j = j;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="e1immutable-annotation">10.1.7. @E1Immutable</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that a type is <a href="#concept-e1immutable">level 1 immutable</a>, effectively or eventually, meaning all fields are effectively or eventually final.</p>
</dd>
<dt class="hdlist1">Group</dt>
<dd>
<p>This annotation sits in between {mutableModifiesArguments} and {e2immutable}.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The <code>add</code> method modifies its parameter <code>input</code>; at the same time, the dependence between the constructor&#8217;s parameter and the field prevents the type from being level 2 immutable:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@E1Immutable</span>
<span class="type">class</span> <span class="class">AddToSet</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; stringsToAdd;

    <span class="annotation">@Dependent</span>
    <span class="directive">public</span> AddToSet(<span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; set) {
        <span class="local-variable">this</span>.stringsToAdd = set;
    }

    <span class="directive">public</span> <span class="type">void</span> add(<span class="annotation">@Modified</span> <span class="annotation">@NotNull1</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; input) {
        input.addAll(set);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="e2container-annotation">10.1.8. @E2Container</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation is a short-hand for the combination of {e2immutable} and  <code>@Container</code> , as described in <a href="#concept-e2immutable">Level n immutable</a> and <a href="#concept-containers">Containers</a>.</p>
</dd>
<dt class="hdlist1">Group</dt>
<dt class="hdlist1">Example</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="e2immutable-annotation">10.1.9. @E2Immutable</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that a type is level 2 immutable, effectively or eventually.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It has two additional parameters:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>level</em>, which is a numeric value at least 2, indicating the level of immutability</p>
</li>
<li>
<p><em>recursive</em>, which is true when recursive, or deep, immutability is meant</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Example</dt>
</dl>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="eRcontainer-annotation">10.1.10. @ImmutableContainer</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation is a short-hand for the combination of effectively recursively immutable (written as <code>@E2Immutable(recursive=true)</code>) and  <code>@Container</code> , as described in <a href="#concept-e2immutable">Level n immutable</a> and <a href="#concept-containers">Containers</a>.</p>
</dd>
<dt class="hdlist1">Group</dt>
<dd>
<p>it sits at the very end of the  <code>@Container</code> , {e1container}, {e2container}, <code>@E2Container(level=3)</code>, &#8230;&#8203;, {ercontainer} sequence.</p>
</dd>
<dt class="hdlist1">Example</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="extensionClass-annotation">10.1.11. @ExtensionClass</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>An extension class is a level 2 immutable class which uses More details can be found in <a href="#concept-extension-class">Extension classes</a>.</p>
</dd>
<dt class="hdlist1">Example</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="final-annotation">10.1.12. @Final</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that a field is effectively or eventually final.
Fields that have the Java modifier <code>final</code> possess the annotation, but the analyser does not write it out to avoid clutter.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>Use this annotation to contract in the green mode, with the opposite, {variable}, being the default.
In the red mode,  <code>@Final</code>  is the default.</p>
</dd>
<dt class="hdlist1">Parameters</dt>
<dd>
<p>The <code>after="mark"</code> parameter indicates that the field is eventually final, after the marking method.</p>
</dd>
<dt class="hdlist1">Details</dt>
<dd>
<p>A field is effectively final when no method, transitively reachable from a non-private non-constructor method, assigns to the field.
A field is eventually final if the above definition holds when one excludes all the methods that are pre-marking, i.e., that hold an annotation <code>@Only(before="mark")</code> or <code>@Mark("mark")</code>.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>Please find an example of an eventually final field in the example of <a href="#e1container-annotation">@E1Container</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example for @Variable, @Final</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span>
<span class="type">class</span> <span class="class">ExampleManualVariableFinal</span> {

    <span class="annotation">@Final</span>
    <span class="directive">private</span> <span class="type">int</span> i;

    <span class="annotation">@Variable</span>
    <span class="directive">private</span> <span class="type">int</span> j;

    <span class="directive">public</span> <span class="directive">final</span> <span class="type">int</span> k; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> ExampleManualVariableFinal(<span class="type">int</span> p, <span class="type">int</span> q) {
        setI(p);
        <span class="local-variable">this</span>.k = q;
    }

    <span class="annotation">@NotModified</span>
    <span class="directive">public</span> <span class="type">int</span> getI() {
        <span class="keyword">return</span> i;
    }

    <span class="annotation">@Modified</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> <span class="type">void</span> setI(<span class="type">int</span> i) {
        <span class="local-variable">this</span>.i = i;
    }

    <span class="annotation">@NotModified</span>
    <span class="directive">public</span> <span class="type">int</span> getJ() {
        <span class="keyword">return</span> j;
    }

    <span class="annotation">@Modified</span>
    <span class="directive">public</span> <span class="type">void</span> setJ(<span class="type">int</span> j) {
        <span class="local-variable">this</span>.j = j;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This field is effectively final, but there is no annotation because of the <code>final</code> modifier.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Note that only the constructor accesses this method.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_finalizer">10.1.13. @Finalizer</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_fluent">10.1.14. @Fluent</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that a method returns <code>this</code>, allowing for method chaining.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite for this annotation.</p>
</dd>
<dt class="hdlist1">Details</dt>
<dd>
<p>Fluent methods do not return a real value.
This is of consequence in the definition of independence for methods, as dependence on <code>this</code> is ignored.</p>
</dd>
<dt class="hdlist1">Example</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Fluent</span>
<span class="directive">public</span> Builder setValue(<span class="type">char</span> c) {
    <span class="local-variable">this</span>.c = c;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_identity">10.1.15. @Identity</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that a method returns its first parameter.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite for this annotation.</p>
</dd>
<dt class="hdlist1">Details</dt>
<dd>
<p>Apart for all the obvious consequences, this annotation has an explicit effect on the linking of variables: a method marked  <code>@Identity</code>  only links to the first parameter.</p>
</dd>
<dt class="hdlist1">Example</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Identity</span>
<span class="directive">public</span> <span class="directive">static</span> &lt;T&gt; requireNonNull(T t) {
    <span class="keyword">if</span>(t == <span class="predefined-constant">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullpointerException();
    <span class="keyword">return</span> t;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ignoremodifications">10.1.16. @IgnoreModifications</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Helper annotation to mark that modifications on a field or parameter are to be ignored, because they fall outside the scope of the application.
This annotation is implicit on parameters of a functional interface type of of <code>java.util.function</code> (e.g., <code>Consumer</code>, <code>Function</code>, etc.).</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite for this annotation.
It can only be used for contracting, the analyser cannot generate it.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The only current use is on <code>System.out</code> and <code>System.err</code>.
The <code>print</code> method family is obviously modifying to these fields, however, we judge it to be outside the scope of the application.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_independent">10.1.17. @Independent</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Annotation used to indicate that a method or constructor avoids linking the fields of the type to the return value and parameters.
This annotation is only present when there are support data fields.
Additionally, on methods, the analyser only computes the annotation when the method is  <code>@NotModified</code>.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>Use this annotation in the green mode.
Its opposite is {dependent}.</p>
<div class="ulist">
<ul>
<li>
<p><mark>TODO</mark> check definition for methods, parameters dependent as well?</p>
</li>
<li>
<p><mark>TODO</mark> why do we ignore dependence on this?</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="independent1-annotation">10.1.18. @Independent1</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>As one of the <a href="#concept-higher-order-modification">[concept-higher-order-modification]</a> annotations, {independent1}
on a parameter, of <a href="#concept-implicitly-immutable">implicitly immutable type</a>, indicates that this parameter is assigned to one of the fields, or assigned into the object graph of one of the fields.
When computed on a method, the return value of the method, again of implicitly immutable type, is known to be part of the object graph of the fields.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>This annotation has no opposite.
It implies  <code>@Independent</code>  because it appears on implicitly immutable types only.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>This annotation has been contracted in many collection-framework methods, such as</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Collections</span>.add(<span class="annotation">@Dependent1</span> E e);

<span class="annotation">@Dependent1</span>
E <span class="predefined-type">List</span>.get(<span class="type">int</span> index);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most direct example explaining the definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Dependent1_0</span>&lt;T&gt; {
    <span class="annotation">@Linked1</span>(to = {<span class="string"><span class="delimiter">&quot;</span><span class="content">Dependent1_0:t</span><span class="delimiter">&quot;</span></span>})
    <span class="directive">private</span> <span class="directive">final</span> T t;

    <span class="directive">public</span> Dependent1_0(<span class="annotation">@Dependent1</span> T t) {
        <span class="local-variable">this</span>.t = t;
    }

    <span class="annotation">@Dependent1</span>
    <span class="directive">public</span> T getT() {
        <span class="keyword">return</span> t;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_linked">10.1.19. @Linked</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Annotation to help debug the dependence system.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_linked1">10.1.20. @Linked1</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Annotation to help debug the dependence system.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_mark">10.1.21. @Mark</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="modified-annotation">10.1.22. @Modified</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Core annotation which indicates that <a href="#concept-modified">modifications</a> take place on a field, parameter, or in a method.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>It is the default in the green mode, when  <code>@NotModified</code> is not visible.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="mutableModifiesArguments-annotation">10.1.23. @MutableModifiesArguments</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation appears on types which are not a container and not level 1 immutable: at least one method will modify its parameters, and at least one field will be variable.
Definitions are in <a href="#concept-containers">Containers</a> and <a href="#concept-e1immutable">Level 1 immutable</a>.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>It is the default in the green mode when none of  <code>@Container</code> , {e1immutable}, {e1container}, {e2immutable}, {e2container} is present.
Use it for contracting in the red mode.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>Types with non-private fields cannot be level 1 immutable.
Here we combine that with a parameter modifying method:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MutableModifiesArguments</span>
<span class="type">class</span> <span class="class">Mutate</span> {
    <span class="annotation">@Variable</span>
    <span class="directive">public</span> <span class="type">int</span> count;

    <span class="directive">public</span> <span class="type">void</span> add(<span class="annotation">@Modified</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; list) {
        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="integer">0</span>; i&lt;count; i++) {
            list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">item </span><span class="delimiter">&quot;</span></span>+i);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="notModified-annotation">10.1.24. @NotModified</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Core annotation which indicates that no <a href="#concept-modified">modifications</a> take place on a field, parameter, or in a method.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>It is the default in the red mode, when its opposite  <code>@Modified</code>  is not present.</p>
</dd>
<dt class="hdlist1">Example</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="notNull-annotation">10.1.25. @NotNull</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Core annotation to indicate that a field, parameter, or result of a method can never be <code>null</code>.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>Use this annotation for contracting in the green mode.
It is the opposite of  <code>@Nullable</code> .</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="notNull1-annotation">10.1.26. @NotNull1</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>the content of an object is  <code>@NotNull</code> , meaning that all the accessible fields of the object are  <code>@NotNull</code> .</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="nullable-annotation">10.1.27. @Nullable</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that the field, parameter, or result of a method can be <code>null</code>.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>This is the default in the green mode, when  <code>@NotNull</code>  is not present.
Use it to contract in the red mode.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="only-annotation">10.1.28. @Only</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Essential annotation for methods in <a href="#concept-eventual">eventually immutable</a> types.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The following example shows a useful <code>@Only(before="&#8230;&#8203;")</code> method.
Please find an example with a useful <code>@Only(after="&#8230;&#8203;")</code> method in <a href="#testMark-annotation">@TestMark</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="singleton-annotation">10.1.29. @Singleton</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that the class is a <a href="#concept-singleton">singleton</a>: only one instance can exist.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite for this annotation.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>There are many ways to ensure that a type has only one instance.
This is the simplest example:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">OnlyOne</span> {
  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> INSTANCE = <span class="keyword">new</span> OnlyOne();

  <span class="directive">public</span> <span class="directive">final</span> <span class="type">int</span> value;

  <span class="directive">private</span> OnlyOne() {
      value = <span class="keyword">new</span> <span class="predefined-type">Random</span>().nextInt(<span class="integer">10</span>);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sse-annotation">10.1.30. @StaticSideEffects</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that at least one method in the type calls a modifying method on a foreign static field.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The expression <code>System.out.println("x")</code> calls the modifying method <code>println</code> on the foreign static field <code>out</code> of the type <code>System</code>.
When this field is not decorated with  <code>@IgnoreModifications</code>  in the Annotated APIs, the type containing the method calling <code>println</code> will be annotated with  <code>@StaticSideEffects</code> .</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="testMark-annotation">10.1.31. @TestMark</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>Part of the <a href="#concept-eventual">eventual</a> system, this annotation is computed for methods which return the state of the object with respect to eventuality: <em>after</em> is <code>true</code>, while <em>before</em> is <code>false</code>.</p>
</dd>
<dt class="hdlist1">Parameters</dt>
<dd>
<p>a parameter <code>before</code> exists to reverse the values: when <code>before</code> is true, the method returns <code>true</code> when the state is <em>before</em> and <code>false</code> when the state is <em>after</em>.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite for this annotation.</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The  <code>@TestMark</code>  annotation in the following example returns <code>true</code> when <code>t != null</code>, i.e., <em>after</em> the marked method <code>setT</code> has been called:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@E2Immutable</span>(after = <span class="string"><span class="delimiter">&quot;</span><span class="content">t</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EventuallyE2Immutable_2</span>&lt;T&gt; {

    <span class="directive">private</span> T t;

    <span class="annotation">@Mark</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">t</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setT(T t) {
        <span class="keyword">if</span> (t == <span class="predefined-constant">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NullPointerException</span>();
        <span class="keyword">if</span> (<span class="local-variable">this</span>.t != <span class="predefined-constant">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>();
        <span class="local-variable">this</span>.t = t;
    }

    <span class="annotation">@Only</span>(after = <span class="string"><span class="delimiter">&quot;</span><span class="content">t</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> T getT() {
        <span class="keyword">if</span> (t == <span class="predefined-constant">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>();
        <span class="keyword">return</span> t;
    }

    <span class="annotation">@TestMark</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">t</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">boolean</span> isSet() {
        <span class="keyword">return</span> t != <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="utilityClass-annotation">10.1.32. @UtilityClass</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that the type is a <a href="#concept-utility-class">utility class</a>: its static side is eventually level 2 immutable, and it cannot be instantiated.
As a consequence, should only have static methods.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>There is no opposite for this annotation.</p>
</dd>
<dt class="hdlist1">Details</dt>
<dd>
<p>The level 2 immutability ensures that the (static) fields are sufficiently immutable.
The fact that it cannot be instantiated is verified by</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the fact that all constructors should be private;</p>
</li>
<li>
<p>there should be at least one private constructor;</p>
</li>
<li>
<p>no method or field can use the constructors instantiate objects of this type.</p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>The following utility class is copied from the analyser:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@UtilityClass</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">IntUtil</span> {

    <span class="directive">private</span> IntUtil() {
    }

    <span class="comment">// copied from Guava, DoubleMath class</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">boolean</span> isMathematicalInteger(<span class="type">double</span> x) {
        <span class="keyword">return</span> !<span class="predefined-type">Double</span>.isNaN(x) &amp;&amp; !<span class="predefined-type">Double</span>.isInfinite(x) &amp;&amp; x == <span class="predefined-type">Math</span>.rint(x);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="variable-annotation">10.1.33. @Variable</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immu <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contract <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field <span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method <span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param <span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>This annotation indicates that a field is not <a href="#concept-e1immutable">effectively or eventually final</a>, i.e., it is assigned to in methods accessible from non-private non-constructor methods in the type.</p>
</dd>
<dt class="hdlist1">Mode</dt>
<dd>
<p>This annotation is the default in the green mode.
It is the opposite of  <code>@Final</code> .</p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p>Any non-eventual type with setters will have fields marked {variable}:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span>
<span class="type">class</span> <span class="class">HoldsOneInteger</span> {

  <span class="annotation">@Variable</span>
  <span class="directive">private</span> <span class="type">int</span> i;

  <span class="directive">public</span> <span class="type">void</span> set(<span class="type">int</span> i) {
    <span class="local-variable">this</span>.i = i;
  }

  <span class="directive">public</span> <span class="type">int</span> get() {
    <span class="keyword">return</span> i;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="annotation-hierarchy">10.2. Relations between annotations</h3>
<div class="paragraph">
<p>In this section we summarize the relations between annotations.</p>
</div>
<div class="sect3">
<h4 id="_on_types">10.2.1. On types</h4>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{e2container} is a shorthand for the combination of {e2immutable} and  <code>@Container</code> ;</p>
</li>
<li>
<p>{e1container} is a shorthand for the combination of {e1immutable} and  <code>@Container</code> ;</p>
</li>
<li>
<p>{e2immutable} requires {e1immutable};</p>
</li>
<li>
<p>a type is {mutableModifiesArguments} if and only if it is not {e1immutable} and not  <code>@Container</code> ;</p>
</li>
<li>
<p>when a type is {mutableModifiesArguments}, there will be at least one field marked {variable}, and at least one parameter marked  <code>@Modified</code> ;</p>
</li>
<li>
<p>by definition, types without fields are {e2immutable};</p>
</li>
<li>
<p>all primitive types are implicitly {e2container}; the analyser will not mark them.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_on_fields">10.2.2. On fields</h4>
<div class="paragraph">
<p>Note that {variable} fields can be  <code>@NotNull</code> !
This obviously requires a not-null initialiser to be present; all other assignments must be not-null as well.
The opposite, a  <code>@Final</code>  field that is  <code>@Nullable</code> , can only occur when the effectively final value is the <code>null</code> constant.</p>
</div>
<div class="paragraph">
<p>The following opposites are easily seen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a field is either  <code>@Final</code>  or {variable}</p>
</li>
<li>
<p>a field is either  <code>@NotModified</code> or  <code>@Modified</code> </p>
</li>
<li>
<p>a field is either  <code>@NotNull</code>  (or {nn1}, or {nn2}), or  <code>@Nullable</code>  (see also <a href="#nullability">Nullability</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{variable} implies  <code>@Modified</code> , whether modifying methods exist for the field or not;</p>
</li>
<li>
<p> <code>@Final</code>   <code>@Modified</code> : part of {e1immutable};</p>
</li>
<li>
<p> <code>@Final</code>   <code>@NotModified</code>: part of {e2immutable}; sufficient for implicitly immutable types; for other types, the visibility and dependence rules kick in.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From the field&#8217;s owning type, following the definitions, we obtain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a type is effectively {e2immutable}, all its fields are  <code>@Final</code>   <code>@NotModified</code>;</p>
</li>
<li>
<p>if a type is effectively {e1immutable}, all its fields are  <code>@Final</code> ;</p>
</li>
<li>
<p>if a type is {mutableModifiesArguments}, at least one of its field is {variable}.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further, note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>fields of a primitive type are always  <code>@NotNull</code>  and  <code>@NotModified</code>, but neither are marked.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_on_constructors">10.2.3. On constructors</h4>
<div class="paragraph">
<p>Non-trivial constructors have the  <code>@Modified</code>  property.
When there is support data, a constructor is either  <code>@Independent</code>  (green) or {dependent} (red).
A constructor without annotations therefore implies either that the type is not {e1immutable}, or that the constructor is not assigning to support data fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_methods">10.2.4. On methods</h4>
<div class="paragraph">
<p>Opposites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a method is either  <code>@NotModified</code> (green) or  <code>@Modified</code>  (red)</p>
</li>
<li>
<p>a method is either  <code>@Independent</code>  (green) or {dependent} (red).
This property is only relevant when there is support data, and the method is  <code>@NotModified</code></p>
</li>
<li>
<p>a method is either  <code>@NotNull</code>  (or {nn1}, or {nn2}) (green), or  <code>@Nullable</code>  (red)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a type is effectively {e2immutable} (green), all its methods are  <code>@NotModified</code> (green).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>quite trivially, <code>void</code> methods have no annotations relating to a return element</p>
</li>
<li>
<p>methods returning a primitive type are  <code>@NotNull</code> , but this is not marked</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_on_parameters">10.2.5. On parameters</h4>
<div class="paragraph">
<p>Opposites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a parameter is either  <code>@NotModified</code> (green) or  <code>@Modified</code>  (red)</p>
</li>
<li>
<p>a parameter is either  <code>@NotNull</code>  (or {nn1}, or {nn2}) (green), or  <code>@Nullable</code>  (red)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a type is  <code>@Container</code> , the parameters of all non-private methods and constructors are  <code>@NotModified</code> (green);</p>
</li>
<li>
<p>a parameter of primitive type, unbound parameter type, functional type, or {e2immutable} type, is always  <code>@NotModified</code> (green);</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a type is {mutableModifiesArguments} (red), at least one of its parameters is  <code>@Modified</code>  (red), which will be marked;</p>
</li>
<li>
<p>quite trivially, parameters of a primitive type are always  <code>@NotNull</code>   and  <code>@NotModified</code>, but we will not mark parameters of a primitive type.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="nullability">10.2.6. Nullability</h4>
<div class="paragraph">
<p>By convention,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{nn1} implies  <code>@NotNull</code> </p>
</li>
<li>
<p>{nn2} implies  <code>@NotNull</code> , {nn1}</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This way of working makes most sense in an immutable setting.</p>
</div>
</div>
<div class="sect3">
<h4 id="_eventually_and_effectively_immutable">10.2.7. Eventually and effectively immutable</h4>
<div class="paragraph">
<p>Field types and method return types can be eventually or effectively immutable when their formal type is not level 1 or level 2 immutable, but the dynamic or computed type is.
In the latter case, static analysis shows that all assignments to the field, or all return statements, result in an immutable object.
In the former case, object flow computation proves that the mark has been passed for this object to have become immutable.</p>
</div>
<div class="paragraph">
<p>When a type is level 1 or level 2 eventually immutable, and the object flow computation proves that all assignments or return statements yield an object which is in a state <em>before</em> the mark, the analyser will emit  <code>@BeforeMark</code> .</p>
</div>
<div class="paragraph">
<p>Fields take the annotation of the eventual state, with the qualification of <code>after="&#8230;&#8203;"</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">not present</th>
<th class="tableblock halign-left valign-top">eventually</th>
<th class="tableblock halign-left valign-top">effectively</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finality of field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{variable}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Final(after="mark")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Final</code> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modification of field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Modified</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotModified(after="mark")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@NotModified</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_list_of_errors_and_warnings">11. List of errors and warnings</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_opinionated">11.1. Opinionated</h3>
<div class="paragraph">
<p>The errors described in this section relate to bad practices that are not tolerated by the analyser:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ASSIGNMENT_TO_FIELD_OUTSIDE_TYPE</dt>
<dd>
<p>Assigning to a field outside the type of that field, is not allowed.
Replace the assignment with a setter method.
Try to do assignments as close as possible to object creation.</p>
</dd>
<dt class="hdlist1">METHOD_SHOULD_BE_MARKED_STATIC</dt>
<dd>
<p>Methods which do not refer to the instance, should be marked <code>static</code>.</p>
</dd>
<dt class="hdlist1">NON_PRIVATE_FIELD_NOT_FINAL</dt>
<dd>
<p>Non-private fields must be effectively final (marked  <code>@Final</code> ).
Who knows what can happen to the field if you allow that?</p>
</dd>
<dt class="hdlist1">PARAMETER_SHOULD_NOT_BE_ASSIGNED_TO</dt>
<dd>
<p>Parameters should not be assigned to.
The implementation of the analyser assumes that parameters cannot be assigned to, so this is probably the one error you really do not want to see.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="evaluation-errors">11.2. Evaluation</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">ASSERT_EVALUATES_TO_CONSTANT_FALSE</dt>
<dd>
<p>The condition in the <code>assert</code> statement is always false.</p>
</dd>
<dt class="hdlist1">ASSERT_EVALUATES_TO_CONSTANT_TRUE</dt>
<dd>
<p>The condition in the <code>assert</code> statement is always true.</p>
</dd>
<dt class="hdlist1">CONDITION_EVALUATES_TO_CONSTANT_ENN</dt>
<dd>
<p>The null or not-null check in the <code>if</code> or <code>switch</code> statement evaluates to constant.
This message is computed via a  <code>@NotNull</code>  on a field.</p>
</dd>
<dt class="hdlist1">CONDITION_EVALUATES_TO_CONSTANT</dt>
<dd>
<p>The condition in the <code>if</code> or <code>switch</code> statement evaluates to a constant.</p>
</dd>
<dt class="hdlist1">INLINE_CONDITION_EVALUATES_TO_CONSTANT</dt>
<dd>
<p>The condition in the inline conditional operator <code>&#8230;&#8203; ? &#8230;&#8203; : &#8230;&#8203;</code> evaluates to a constant.</p>
</dd>
<dt class="hdlist1">PART_OF_EXPRESSION_EVALUATES_TO_CONSTANT</dt>
<dd>
<p>Part of a short-circuit boolean expression (involving <code>&amp;&amp;</code> or <code>||</code>) evaluates to a constant.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_empty_unused">11.3. Empty, unused</h3>
<div class="paragraph">
<p>Errors of this type are typically trivial to clean up, so why not do it immediately?</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">EMPTY_LOOP</dt>
<dd>
<p>Empty loop: the loop will run over an <code>Iterable</code> which the analyser believes is empty.</p>
</dd>
<dt class="hdlist1">IGNORING_RESULT_OF_METHOD_CALL</dt>
<dd>
<p>Ignoring result of method call.
That&#8217;s fine when the method is modifying, but the call is pretty useless when the method is  <code>@NotModified</code>.</p>
</dd>
<dt class="hdlist1">UNNECESSARY_METHOD_CALL</dt>
<dd>
<p>Unnecessary method call, like, e.g., calling <code>toString()</code> on a <code>String</code>.</p>
</dd>
<dt class="hdlist1">UNREACHABLE_STATEMENT</dt>
<dd>
<p>Unreachable statement, often because of an error from the <a href="#evaluation-errors">Evaluation</a> category.</p>
</dd>
<dt class="hdlist1">UNUSED_LOCAL_VARIABLE</dt>
<dd>
<p>Unused local variable.</p>
</dd>
<dt class="hdlist1">UNUSED_LOOP_VARIABLE</dt>
<dd>
<p>Unused loop variable.</p>
</dd>
<dt class="hdlist1">UNUSED_PARAMETER</dt>
<dd>
<p>Unused parameter.
Not raised when the method is overriding another method.</p>
</dd>
<dt class="hdlist1">USELESS_ASSIGNMENT</dt>
<dd>
<p>Useless assignment.</p>
</dd>
<dt class="hdlist1">TRIVIAL_CASES_IN_SWITCH</dt>
<dd>
<p>Trivial cases in <code>switch</code>.</p>
</dd>
<dt class="hdlist1">PRIVATE_FIELD_NOT_READ</dt>
<dd>
<p>Private field not read outside constructors.
If this is intentional, turn it into a local variable.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_verifying_annotations">11.4. Verifying annotations</h3>
<div class="paragraph">
<p>The following errors relate to the annotations you added to your source code, to verify that a type, method or field has a given property.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ANNOTATION_ABSENT</dt>
<dd>
<p>Annotation missing.
You wrote the annotation in the source code, but it is absent from the computation of the analyser.</p>
</dd>
<dt class="hdlist1">ANNOTATION_UNEXPECTEDLY_PRESENT</dt>
<dd>
<p>You explicitly write that the annotation should be absent, using <code>absent=true</code>, still, the analyser computes it.</p>
</dd>
<dt class="hdlist1">CONTRADICTING_ANNOTATIONS</dt>
<dd>
<p>Contradicting annotations</p>
</dd>
<dt class="hdlist1">WRONG_ANNOTATION_PARAMETER</dt>
<dd>
<p>Wrong annotation parameter: the annotation is both in the source code, and computed by the analyser.
However, the associated values are differing.</p>
</dd>
<dt class="hdlist1">WORSE_THAN_OVERRIDDEN_METHOD_PARAMETER</dt>
<dd>
<p>Property value worse than overridden method&#8217;s parameter</p>
</dd>
<dt class="hdlist1">WORSE_THAN_OVERRIDDEN_METHOD</dt>
<dd>
<p>Property value worse than overridden method</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_immutability_2">11.5. Immutability</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">CALLING_MODIFYING_METHOD_ON_E2IMMU</dt>
<dd>
<p>Calling a modifying method on level 2 immutable type is not allowed.
This error is typically raised when the type is only dynamically computed to be level 2 immutable, such as in the case of the immutable version of a collection.</p>
</dd>
<dt class="hdlist1">DUPLICATE_MARK_CONDITION</dt>
<dd>
<p>Duplicate mark precondition</p>
</dd>
<dt class="hdlist1">EVENTUAL_AFTER_REQUIRED</dt>
<dd>
<p>Calling a method requiring <code>@Only(after)</code> on an object in state <code>@Only(before)</code>.</p>
</dd>
<dt class="hdlist1">EVENTUAL_BEFORE_REQUIRED</dt>
<dd>
<p>Calling a method requiring <code>@Only(before)</code> on an object in state <code>@Only(after)</code>.</p>
</dd>
<dt class="hdlist1">INCOMPATIBLE_IMMUTABILITY_CONTRACT_AFTER_NOT_EE1</dt>
<dd>
<p>Incompatible immutability contract: Contracted to be @E2Immutable after the mark, formal type is not (eventually) @E1Immutable.
Variants exist for <code>@Only(before="&#8230;&#8203;")</code>, and level 2 immutable.</p>
</dd>
<dt class="hdlist1">INCOMPATIBLE_PRECONDITION</dt>
<dd>
<p>Incompatible preconditions</p>
</dd>
<dt class="hdlist1">WRONG_PRECONDITION</dt>
<dd>
<p>Wrong precondition</p>
</dd>
<dt class="hdlist1">PRECONDITION_ABSENT</dt>
<dd>
<p>Precondition missing</p>
</dd>
<dt class="hdlist1">ONLY_WRONG_MARK_LABEL</dt>
<dd>
<p>@Only annotation, wrong mark label</p>
</dd>
<dt class="hdlist1">MODIFICATION_NOT_ALLOWED</dt>
<dd>
<p>Illegal modification suspected</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_odds_and_ends">11.6. Odds and ends</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">CIRCULAR_TYPE_DEPENDENCY</dt>
<dd>
<p>Methods that call each other circularly, make it difficult for the analyser to compute modifications correctly.</p>
</dd>
<dt class="hdlist1">DIVISION_BY_ZERO</dt>
<dd>
<p>The analyser suspects division by zero here.</p>
</dd>
<dt class="hdlist1">FINALIZER_METHOD_CALLED_ON_FIELD_NOT_IN_FINALIZER</dt>
<dd>
<p>A  <code>@Finalizer</code>  method can only be called on a field, when in another  <code>@Finalizer</code>  method.
Please refer to <a href="#concept-finalizer">Finalizers</a>.</p>
</dd>
<dt class="hdlist1">FINALIZER_METHOD_CALLED_ON_PARAMETER=</dt>
<dd>
<p>A  <code>@Finalizer</code>  method cannot be called on a parameter.
Please refer to <a href="#concept-finalizer">Finalizers</a>.</p>
</dd>
<dt class="hdlist1">NULL_POINTER_EXCEPTION</dt>
<dd>
<p>The analyser suspects that this will always raise a null-pointer exception.</p>
</dd>
<dt class="hdlist1">POTENTIAL_NULL_POINTER_EXCEPTION</dt>
<dd>
<p>The analyser suspects, and only warns, for a potential null-pointer exception.</p>
</dd>
<dt class="hdlist1">TYPES_WITH_FINALIZER_ONLY_EFFECTIVELY_FINAL</dt>
<dd>
<p>Fields of types with a  <code>@Finalizer</code>  method can only be assigned to an effectively final ( <code>@Final</code> ) field.
Please refer to <a href="#concept-finalizer">Finalizers</a>.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical"><em>Technical</em></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_implementation">12. Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The principles of  <em>e2immu</em>  guide the implementation of the analyser:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try to use containers exclusively, in other words: never modify your parameters.</p>
</li>
<li>
<p>Use as many immutable objects as possible; either directly, via builders, or via eventually final constructs.</p>
</li>
<li>
<p>Never backtrack on decisions: delay making a decision as long as you cannot be sure, but once a decision is made, it is rock-solid.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The container requirement has been broken in exactly one situation: that of the <code>ExpressionContext</code>.
Because we intend to use the implementation as one of the more serious test cases of  <em>e2immu</em> , one such situation is acceptable.
It nicely contrasts with <code>EvaluationContext</code>, which does follow the rules, and which relies on an <code>EvaluationResult</code> to be applied.</p>
</div>
<div class="sect2">
<h3 id="_main_flow">12.1. Main flow</h3>
<div class="paragraph">
<p>The main orchestrating class of  <em>e2immu</em>  is the <code>Parser</code> class, which initiates the different phases of  <em>e2immu</em> :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>configuration and input preparation;</p>
</li>
<li>
<p>inspection, transforming source code into objects at the type, method and field level;</p>
</li>
<li>
<p>resolution, tying these objects together, while at the same time parsing statements and expressions;</p>
</li>
<li>
<p>analysis, providing semantic information;</p>
</li>
<li>
<p>output, showing and storing the results of the analysis.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The key classes for configuration and input preparation are, easily enough, <code>Configuration</code>, <code>Input</code>, <code>Resources</code>, <code>ClassPath</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inspection">12.2. Inspection</h3>
<div class="paragraph">
<p>The  <em>e2immu</em>  project currently depends on two libraries to help transform the Java source code and byte code into objects: JavaParser for the source, and ASM for the byte code.
Currently, the byte code inspector does not inspect statements.</p>
</div>
<div class="paragraph">
<p>Byte code inspection is done on-demand, because the system libraries provided with the Java Runtime are too extensive to convert <em>a priori</em>.
The main class responsible is the <code>ByteCodeInspector</code>.</p>
</div>
<div class="paragraph">
<p>Inspection using JavaParser is primarily carried out by the <code>TypeInspector</code> and the <code>MethodInspector</code>.</p>
</div>
<div class="paragraph">
<p>Both inspection types fill up a <code>TypeMap</code> (which exists as a builder and a final, immutable implemention constructed after the resolution phase), which keeps track of all types known to  <em>e2immu</em> .
A <code>TypeContext</code> object provides support for translating locally known simple type names to fully qualified ones.</p>
</div>
<div class="paragraph">
<p>The end result of inspection are the types</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>TypeInfo</code>, with inspection details in <code>TypeInspection</code>;</p>
</li>
<li>
<p><code>MethodInfo</code>, with inspection details in <code>MethodInspection</code>;</p>
</li>
<li>
<p><code>FieldInfo</code>, with inspection details in <code>FieldInspection</code>;</p>
</li>
<li>
<p><code>ParameterInfo</code>, with inspection details in <code>ParameterInspection</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_resolution">12.3. Resolution</h3>
<div class="paragraph">
<p>The resolution phase has two primary goals.
Firstly, it parses method bodies into statements (implementations of the interface <code>Statement</code>), starting with <code>Block</code>, and expressions (implementations of <code>Expression</code>).
Central to the inspection of expressions is the <code>ExpressionContext</code>.
Secondly, the resolution phase resolves all remaining type and method determination issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>which method call is meant in the face of overrides and overloads;</p>
</li>
<li>
<p>it keeps track of the place of a type in the hierarchy, available for reference to the analyser;</p>
</li>
<li>
<p>it determines the types of objects created with the diamond operator <code>&lt;&gt;</code>, of lambda&#8217;s without explicit parameter types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even though JavaParser has its own symbol-solving module,  <em>e2immu</em>  uses its own implementation.
The most complicated of the resolution classes is <code>ParseMethodCallExpr</code>, which determines the exact method call.
A lot of logic dealing with the type hierarchy is in <code>ParameterizedType</code>, the class responsible for representing types decorated with concrete values for type parameters.</p>
</div>
<div class="paragraph">
<p>The <code>Resolver</code> is the main class here, it adds <code>TypeResolution</code> to <code>TypeInfo</code>, and <code>MethodResolution</code> to <code>MethodInfo</code>.</p>
</div>
<div class="paragraph">
<p>The output of the resolution phase is a list of types, sorted in order of dependency.
This sorting step is necessary for analysis, to the extent that circular dependencies between types make analysis a lot harder.
The class <code>SortedType</code> transfers information from the <code>Resolver</code> into the <code>PrimaryTypeAnalyser</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_analysers">12.4. Analysers</h3>
<div class="paragraph">
<p>In  <em>e2immu</em> , a number of different analysers cooperate to determine the semantic properties of the code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <em>type analyser</em>, instantiated once for each (nested) type;</p>
</li>
<li>
<p>the <em>method analyser</em>, instantiated for each method or constructor, even some hidden ones;</p>
</li>
<li>
<p>the <em>parameter analyser</em>, instantiated for each parameter of each method and constructor;</p>
</li>
<li>
<p>the <em>field analyser</em>, instantiated for each field;</p>
</li>
<li>
<p>the <em>statement analyser</em>, instantiated for each statement of each method and constructor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are obvious and strong dependencies between these analysers, e.g., the modification aspect of a field depends on determining whether there are statements that modify it.
At the same time, there are dependencies between different aspects of the code, e.g., between methods calling other methods, methods initialising fields, etc.
There is no easy way to determine an exact execution order for this multitude of analyser instances.</p>
</div>
<div class="paragraph">
<p>To this end, the analyser implements an iterative approach, that gives each analyser one opportunity per iteration to determine its values and properties based on previously established facts.</p>
</div>
<div class="paragraph">
<p>When a value or property cannot yet be determined, typically because a dependency has not yet been met, this value or property is <strong>delayed</strong>.
The delay system keeps track of the causes of the delay, to allow for detecting circular dependencies.
The latter can then be broken, to allow the iterative system to continue.
As soon as a value has been determined, it is written out for others to refer to, and cannot be changed anymore.</p>
</div>
<div class="paragraph">
<p>The analysers themselves consist of a number of components (or tasks), which are executed as part of the iteration.
This execution takes place in a fixed order; it starts at the first, not-yet-executed (in the first iteration) or non-delayed (in the subsequent ones) component, and visits all others in the chain.
The main loop stops iterating when all components have been resolved (are in the <em>done</em> state, rather than the <em>delayed</em> state).</p>
</div>
<div class="paragraph">
<p>The order of the main analyser groups is</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>methods.
For each method, the analyser processes the</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>parameters;</p>
</li>
<li>
<p>statements, from first to last, recursively descending as explained later;</p>
</li>
<li>
<p>method itself;</p>
</li>
</ol>
</div>
</li>
<li>
<p>fields;</p>
</li>
<li>
<p>types.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Inside the primary type (the .java file) the methods are processed alphabetically, as are the fields and nested types.
This orchestration is the responsibility of the <code>PrimaryTypeAnalyser</code>, which is also used, recursively, to analyse types defined inside statements.
It employs the <code>AnalyserComponents</code> class to execute the components.</p>
</div>
<div class="paragraph">
<p>Annotated API files (or classes) are analysed by the <code>AnnotatedAPIAnalyser</code>, which is a shallow version of the primary type analyser, the type analyser (<code>ComputingTypeAnalyser</code>) and the field analyser (<code>FieldAnalyser</code>).
Methods without code are analysed by the <code>ShallowMethodAnalyser</code>, rather than the <code>ComputingMethodAnalyser</code> and <code>ComputingParameterAnalyser</code>.</p>
</div>
<div class="paragraph">
<p>In the special situation of <em>sealed</em> classes, we need a variant on the shallow analysers which aggregate data from the computed analysers in the child types.
These are the <code>AggregatingTypeAnalyser</code>, <code>AggregatingMethodAnalyser</code>, and <code>AggregatingParameterAnalyser</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_statements_and_expressions">12.5. Statements and expressions</h3>
<div class="paragraph">
<p>Due to the hierarchical nature of statements, statement analysers and statement analysis objects are also structured hierarchically.
The statements of a method are internally numbered from 0 onward.
Because of the hierarchical nature, a dotted system is used: each sub-block introduces a dot, a sub-block number, and a dot again.
So <code>0.1.2</code> indicates the 3rd statement in the 2nd block of the first statement of the method.
The second block can be a "catch"-block, or the "else" block in an "if-else" statement.</p>
</div>
<div class="paragraph">
<p>The general <code>Statement</code> interface has an implementation per type of statement specific to the Java language.
Many of them contain expressions, represented by the <code>Expression</code> interface.
Again, the typical range of expression implementations exist, mostly corresponding to expressions existing in the language.
Specific to this implementation are <code>DelayedExpression</code>, <code>DelayedVariableExpression</code>, and <code>PropertyWrapper</code>.</p>
</div>
<div class="paragraph">
<p>Expressions can be evaluated in the context in which they appear, the <code>EvaluationContext</code>.
The result of this evaluation is an <code>EvaluationResult</code> object, which is subsequently processed by the statement analyser.
When dependencies inside the expression have not been resolved yet (e.g., the return value of a method is still unknown, or a variable doesn&#8217;t have a value yet), the end result is an expression which contains delayed components.
Each expression answers the <code>isDelayed</code> method, and can return a <code>CausesOfDelay</code> object to identify exactly what the reasons for the delay are.</p>
</div>
<div class="paragraph">
<p>Some evaluation leads to simplification of the expression, which is sometimes a reason to emit a warning to the developer.
When a complex expression evaluates to a constant, for example, it is likely that they should know about this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_analysis_objects">12.6. Analysis objects</h3>
<div class="paragraph">
<p>Each analyser has a corresponding analysis object, which contains the results of the analysis.
After analysis, the analyser is dropped, the analysis object remains.
Each analysis component consists of two implementations: the builder, which holds the values while the analyser is alive, and the effectively immutable implementation which survives the analyser.
There is currently one exception: the <code>StatementAnalyser</code> only has a <code>StatementAnalysis</code> data companion, which holds eventually immutable objects.
The <code>MethodAnalysis</code> interface has a <code>MethodAnalysisImpl</code> immutable implementation, and a <code>MethodAnalysisImpl.Builder</code> mutable builder.</p>
</div>
<div class="paragraph">
<p>An important aspect of the builders is that writing information is constrained: while causes of delay can be overwritten in each iteration, once a value has been determined for a property or some piece of information the analyser has to store, it cannot be changed anymore.
To this end, we employ a variation of eventually final helper classes, such as <code>EventuallyFinal</code> and <code>VariableFirstThen</code>, with <code>setVariable</code> and <code>setFinal</code> write methods.</p>
</div>
<div class="paragraph">
<p>The <code>StatementAnalysis</code> data object holds a number of sub-objects, where data is stored per topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NavigationData</code> holds the data structure that points to the next statement, and the first statements of sub-blocks.
This data structure can be modified by statement replacements.</p>
</li>
<li>
<p><code>FlowData</code> holds the conditions under which this statement will be executed, and what the effect is on the flow of execution.
E.g., a <code>throws</code> statement will cause either a guaranteed, or a conditional escape from the execution flow.</p>
</li>
<li>
<p><code>StateData</code> holds state of the variables.
After a conditional escape, for example, the state will be the negation of the condition that caused the escape.</p>
</li>
<li>
<p><code>MethodLevelData</code> holds the data necessary for the method analyser; typically, only the method level data of the last statement of the method will be inspected.</p>
</li>
<li>
<p><code>ConditionManager</code> is a support object that holds condition, state, and precondition in one object.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_properties">12.7. Properties</h3>
<div class="paragraph">
<p>The analysers compute semantic information, some of which can be expressed as numeric values for properties, many of which apply to most of the analysers.
These properties can then be visualised, either by coloring, highlighting in an IDE, or by adding annotations.</p>
</div>
<div class="paragraph">
<p>A property (implemented by the enumeration <code>Property</code>) has a numeric value when it is not delayed.
Otherwise, it takes a <code>CausesOfDelay</code> value, which enumerates the reasons why no value was computed for this property.
The property-value map <code>Properties</code> maps <code>Property</code> to <code>DV</code>.
The latter stands for <em>delayable value</em>.</p>
</div>
<div class="paragraph">
<p>There are four types of properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>value properties</p>
</li>
<li>
<p>context properties</p>
</li>
<li>
<p>external properties</p>
</li>
<li>
<p>internal marker properties</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_value_properties">12.7.1. Value properties</h4>
<div class="paragraph">
<p>Value properties are associated with a expression which has been evaluated to a non-delayed result.
When a variable takes a value, the variable&#8217;s value properties are computed directly from the value.
There are five value properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOT_NULL_EXPRESSION</code>: the not-null aspect of an evaluated expression, seen outside its context.
Its associated annotations are  <code>@Nullable</code> ,  <code>@NotNull</code> , and {nn1}.</p>
</li>
<li>
<p><code>IMMUTABLE</code>: the immutability aspect of an evaluated expression, tied to the dynamic type, seen outside its context.
Associated annotations are {mutableModifiesArguments}, {e1immutable}, {e2container}, &#8230;&#8203;</p>
</li>
<li>
<p><code>INDEPENDENT</code>: the "independent" aspect of the evaluated expression, tied to the dynamic type.
Annotations are {dependent}, {independent1},  <code>@Independent</code> .</p>
</li>
<li>
<p><code>CONTAINER</code>: the "container" aspect, by default tied to the dynamic type, but potentially modified (from false to true) by a contract.
The annotation needed to contract an abstract parameter to be of container type is  <code>@Container</code> .</p>
</li>
<li>
<p><code>IDENTITY</code>: the fact that the evaluated expression is exactly the value of the first parameter of the method.
Corresponds to  <code>@Identity</code>  on the method.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_context_properties">12.7.2. Context properties</h4>
<div class="paragraph">
<p>In contrast, context properties are unique to a variable, and are held independently of the value that the variable takes.
Context properties accumulate information about the variable from one statement to the next.
There are three context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CONTEXT_NOT_NULL</code>: the not-null aspect of the variable in the given context.
E.g., when the variable appeared in the scope of a method, it must be not-null.
When the variable appeared as the argument of an <code>addAll</code> method, it must be content-not-null.
CNN takes the Condition Manager into account: in the context of <code>if(x != null)</code>, the statement <code>x.method()</code> does not force the CNN of <code>x</code> to the not null value.</p>
</li>
<li>
<p><code>CONTEXT_IMMUTABLE</code>: can be higher than the formal immutability value</p>
</li>
<li>
<p><code>CONTEXT_MODIFIED</code>, independent of value, value delays; however, values <strong>change</strong> depending on modification due to companions!
As soon as a variable representing a field, or <code>this</code>, has this property set to true, the method in which this occurs is marked modifying, which is visualised by the  <code>@Modified</code>  property.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_external_properties">12.7.3. External properties</h4>
<div class="paragraph">
<p>When a field is assigned to a parameter in a constructor, the value of the field and that of the parameter are bound to each other.
To break a very predictable circular dependency, parameters receive a value right from the first iteration.
Because value properties are bound to this value, their eventual values may differ from the ones necessarily chosen in the very first iteration.
The external properties receive the final values of the value properties for parameters, and for all other values for which a circular dependency had to be broken.
A second example is the <code>this</code> variable, which can only get the correct immutability value once the type analyser has established it, but modification computation cannot continue until <code>this</code> has a value, and the type analyser needs the modification computations.
There are two external properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EXTERNAL_NOT_NULL</code>: of relevance when CNN demands a high value, but the field cannot allow for one.
So ENN &lt; CNN, and this will result in a potential null-pointer warning</p>
</li>
<li>
<p><code>EXTERNAL_IMMUTABLE</code>: of relevance when CIMM demands a higher value than the formal type&#8217;s value, but the dynamic value cannot go as high.
Results in a modification warning.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By convention, external properties on parameters have the value <code>NOT_INVOLVED</code> when the parameter is not linked to a field.</p>
</div>
<div class="paragraph">
<p>The property <code>MODIFIED_OUTSIDE_METHOD</code> is similar to an external property.
It originates in the field analyser. <mark>TODO rename?</mark></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_variables">12.8. Variables</h3>
<div class="paragraph">
<p>A statement analyser, and associated statement analysis builder object, is present for each statement.
The builder holds information about the state of all the variables known to the statement.</p>
</div>
<div class="paragraph">
<p>Parameters are known from the first statement onwards; fields are only introduced in the statement that refers to them.
All subsequent statements will also know the statement.</p>
</div>
<div class="paragraph">
<p>Each variable in the statement analyser has values for three "levels"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <em>initial</em> value, or value of the previous statement (I)</p>
</li>
<li>
<p>the <em>evaluated</em> value (E)</p>
</li>
<li>
<p>the <em>merged</em> value (M), as the summary of all nested statements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obviously, not all statements allow for nested statements; they will not have an M level.
Information about a variable is stored in a <code>VariableInfoContainer</code>, which holds <code>VariableInfo</code> instances for each of the three levels.
A <code>VariableInfo</code> object holds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the variable and its name</p>
</li>
<li>
<p>a value</p>
</li>
<li>
<p>linked variables</p>
</li>
<li>
<p>at which statement times it was read</p>
</li>
<li>
<p>by which statements it was written</p>
</li>
<li>
<p>by which statement it was last read.</p>
</li>
<li>
<p>a property-value map.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a field is detected during the evaluation phase, it cannot yet have a value at the initial level.
A delayed value expression is returned for this field.
In the next iteration, the field analyser may provide an initial value for the field.</p>
</div>
<div class="paragraph">
<p>Variable fields and loop variables have "local copies" which exist starting from the 2nd iteration.</p>
</div>
<div class="paragraph">
<p>A variable which points to a generic value (of type <code>Instance</code>) is evaluated to a <code>VariableExpression</code>, rather than the value itself.
When variable <code>b</code> is assigned to variable <code>a</code>, <code>a</code> can have this <code>VariableExpression</code> as a value.
No further redirections are possible.</p>
</div>
<div class="paragraph">
<p>Variables are identified by their fully qualified name.
Local copies can be identified by the <code>$</code> sign and the suffix, either specifying the latest assignment and read statement ids, or the statement time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clustering">12.9. Clustering</h3>
<div class="paragraph">
<p>Variables link to other variables at different levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>static assignments (<code>a = b</code>)</p>
</li>
<li>
<p>dynamic assignments, e.g., <code>a = Objects.requireNonNull(b)</code>, which become assignments after evaluation</p>
</li>
<li>
<p>linking at the accessible content level (dependent objects), <code>s = t.subList(0, 3)</code></p>
</li>
<li>
<p>linking at the hidden content level, <code>a.add(b)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The context properties are assigned to clusters of variables: after executing <code>a=b; b.doSomething()</code>, for example, we must set the context not null value of <code>a</code> to not-null as well.</p>
</div>
<div class="paragraph">
<p>The static assignment level is different from the three other levels in that it is available from the first iteration onward.
Local copies of variable fields and variables assigned to in a loop are only introduced in the 2nd iteration; however, they simply expand the cluster and cannot cause different context property values.</p>
</div>
<div class="paragraph">
<p>The only context property which is computed across the first three levels (i.e., static and dynamic assignment, and linking at the accessible content level) is <em>context modification</em>: after executing <code>s = t.subList(0, 3); s.add(x);</code> both <code>s</code> and <code>t</code> are likely to be modified.</p>
</div>
<div class="paragraph">
<p>The result of linking is stored in the <code>linkedVariables</code> field of <code>VariableInfo</code>; it is of type <code>LinkedVariables</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_typical_execution_order">12.10. Typical execution order</h3>
<div class="paragraph">
<p>Parameters start with values, nullable, mutable in case of self-references; then they rely on ENN, ExtImm.</p>
</div>
<div class="paragraph">
<p><code>this</code> also starts with a value, relies on ENN, ExtImm</p>
</div>
<div class="paragraph">
<p>statical assignment linking → CNN, CIMM - delays only on dependent methods</p>
</div>
<div class="paragraph">
<p>CondMgr works on delayed values, to assist in correct CNN values</p>
</div>
<div class="paragraph">
<p>field value ← last statement + initialiser values + CNN, CIMM</p>
</div>
<div class="paragraph">
<p>in statements, delayed variable value is replaced by field value + IMM + NNE</p>
</div>
<div class="paragraph">
<p>Rest of linking follows as soon as there are values → CM → type immutable</p>
</div>
<div class="paragraph">
<p>Breaking a circular computation CNN → field → ENN → NNP → CNN deactivates this local CNN.</p>
</div>
<div class="paragraph">
<p>ENN, ExtImm can always augment on fields when value was chosen after breaking circular computation</p>
</div>
</div>
<div class="sect2">
<h3 id="_output_system">12.11. Output system</h3>
<div class="paragraph">
<p>The output system of  <em>e2immu</em>  is very lightweight, yet sufficiently flexible to be parameterizable between extremely compact and nicely readable.
Output elements (implementations of <code>OutputElement</code>, such as <code>Text</code>, <code>Symbol</code>, <code>Space</code>, and <code>Guide</code>) are collected in an <code>OutputBuilder</code>, and finally emitted by the <code>Formatter</code> which is parameterized by <code>FormatterOptions</code>.
The <code>OutputBuilder</code> implements the <code>Collector</code> interface from the JDK streaming package, which allows for simple conversion and collection of lists and streams of statements, expressions, types, etc. into <code>OutputElement</code> and then <code>OutputBuilder</code> instances.</p>
</div>
<div class="paragraph">
<p>At the moment the implementation is not tied to the inspection system, so there is no way to link back to line numbers and symbol positions of the original source.
It is also not possible to maintain the existing formatting.</p>
</div>
<div class="paragraph">
<p>Errors and warnings are stored in an enumeration called <code>Message.Label</code>, and are decorated with a <code>Location</code> and some textual information.
They are collected in a <code>Messages</code> object.
Resource files allow for translation of the messages in other languages.</p>
</div>
<div class="paragraph">
<p>The <code>Location</code> object holds an <code>Identifier</code>, which can be of the <code>PositionalIdentifier</code> variety that refers to the line number and position in the original source code, provided by the JavaParser.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supporting_tools">13. Supporting tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_gradle_plugin">13.1. Gradle plugin</h3>
<div class="paragraph">
<p>The Gradle plugin greatly facilitates the use of the analyser by integrating it your project&#8217;s build process.
We based its initial implementation on the one from <a href="https://www.sonarqube.org/" target="_blank" rel="noopener">SonarQube</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of <code>build.gradle</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.analyser</span><span class="delimiter">'</span></span>
}

...

repositories {
    ...
}

dependencies {
   ...
}

e2immu {
    skipProject = <span class="predefined-constant">false</span>
    sourcePackages = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.</span><span class="delimiter">'</span></span>
    jmods = <span class="string"><span class="delimiter">'</span><span class="content">java.base.jmod,java.se.jmod</span><span class="delimiter">'</span></span>
    jre = <span class="string"><span class="delimiter">'</span><span class="content">/Library/Java/JavaVirtualMachines/openjdk-11.0.2.jdk/Contents/Home/</span><span class="delimiter">'</span></span>
    writeAnnotatedAPIPackages = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.</span><span class="delimiter">'</span></span>
    writeAnnotationXMLPackages = <span class="string"><span class="delimiter">'</span><span class="content">org.e2immu.</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of properties configurable differs slightly from the one of the command line.
Gradle takes care of source and class path.</p>
</div>
</div>
<div class="sect2">
<h3 id="_key_value_store">13.2. Key-value store</h3>
<div class="paragraph">
<p>The key-value store is a simple, two-class implementation of an independent key-value store acting as a bridge between the  <em>e2immu</em>  analyser and the  IntelliJ IDEA  plugin.
It is mostly agnostic to the purpose in the project: it stores key-value pairs in sub-stores called projects.</p>
</div>
<div class="paragraph">
<p>Unless directed differently by the <code>e2immu-port</code> parameter, the store starts listening on port 8281 for HTTP communication.
The protocol summary is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"># get an annotation name for an element
# curl http://localhost:8281/v1/get/project-name/element-description
#
# set the annotation name for an element
# curl http://localhost:8281/v1/set/project-name/element-description/annotation-name
#
# get annotation names for a whole list of elements
# curl -X POST @elements.json http://localhost:8281/v1/get/project-name
#
# set the annotation names for a whole map of elements
# curl -X PUT @elementsandannotations.json http://localhost:8281/v1/set/project-name
#
# get all key-value pairs for a project
# curl http://localhost:8281/v1/list/project-name
#
# list all projects
# curl http://localhost:8281/v1/list</code></pre>
</div>
</div>
<div class="paragraph">
<p>Projects that do not exist will be created on-demand.
The bulk <em>get</em> operation may receive more elements than that it asked for:
depending on the effects of recent <em>set</em> operations, the store may include recently updated keys that were asked for recently as well.</p>
</div>
<div class="paragraph">
<p>Start the store by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">~/g/e/annotation-store (master)&gt; gradle run

&gt; Task :annotation-store:run
Aug 01, 2020 9:19:55 AM org.e2immu.kvstore.Store
INFO: Started kv server on port 8281; read-within-millis 5000
&lt;=========----&gt; 75% EXECUTING [1m 39s]
&gt; :annotation-store:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>In another terminal, experiment with the <code>curl</code> statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">~&gt; curl http://localhost:8281/v1/get/default/hello
{&quot;hello&quot;:&quot;&quot;}⏎
~&gt; curl http://localhost:8281/v1/set/default/hello/there
{&quot;updated&quot;:1,&quot;ignored&quot;:0,&quot;removed&quot;:0}⏎
~&gt; curl http://localhost:8281/v1/get/default/hello
{&quot;hello&quot;:&quot;there&quot;}⏎
~&gt; curl http://localhost:8281/v1/set/default/its/me
{&quot;updated&quot;:1,&quot;ignored&quot;:0,&quot;removed&quot;:0}⏎
~&gt; curl http://localhost:8281/v1/list/default
{&quot;its&quot;:&quot;me&quot;,&quot;hello&quot;:&quot;there&quot;}⏎
~&gt; curl http://localhost:8281/v1/list
{&quot;projects&quot;:[&quot;default&quot;]}⏎</code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing a key-value pair only works via the PUT method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">~&gt; curl http://localhost:8281/v1/set/default/its/
&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource not found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;⏎
~&gt; cat update.json
{&quot;its&quot;:&quot;&quot;,&quot;hello&quot;:&quot;here&quot;}
~&gt; curl -X PUT -d @update.json  http://localhost:8281/v1/set/default
{&quot;updated&quot;:1,&quot;ignored&quot;:0,&quot;removed&quot;:1}⏎
~&gt; curl http://localhost:8281/v1/list/default
{&quot;hello&quot;:&quot;here&quot;}⏎</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_intellij_idea_plugin">13.3.  IntelliJ IDEA  plugin</h3>
<div class="paragraph">
<p>Without a plugin for an IDE, the analyser would be hard to use, and the main purpose of the project, namely, unobtrusively assisting in better coding, would remain very far off.
The current plugin for  IntelliJ IDEA  is absolutely minimal.
We based our initial implementation on the <a href="https://plugins.jetbrains.com/plugin/13303-return-highlighter" target="_blank" rel="noopener">Return statement highlighter plugin</a> by Edoardo Luppi.</p>
</div>
<div class="sect3">
<h4 id="visual-objectives">13.3.1. Visual objectives</h4>
<div class="paragraph">
<p>For the proof of concept, we aim to color elements of the source code in such a way that there is visual information explaining why a type is not {e2immutable} or  <code>@Container</code> .
In the green mode, we highlight the immutable elements, which useful when they are sparse.
In the red mode, we warn for mutable ones in an otherwise pretty immutable environment:</p>
</div>
<div class="paragraph">
<p>Following the <a href="#annotation-hierarchy">Relations between annotations</a> for types, we color:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">annotation on type</th>
<th class="tableblock halign-left valign-top">green mode</th>
<th class="tableblock halign-left valign-top">red mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{e2container} (incl. primitives)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{e2immutable}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{e1container}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{e1immutable}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Container</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{mutableModifiesArguments}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@BeforeMark</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">purple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">purple</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For fields, we note that {variable}- <code>@Final</code>  and  <code>@NotModified</code>- <code>@Modified</code>  can technically occur in each combination:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{variable}  <code>@Modified</code> : impossible for unmodifiable types</p>
</li>
<li>
<p>{variable}  <code>@NotModified</code></p>
</li>
<li>
<p> <code>@Final</code>   <code>@Modified</code> : part of {e1immutable}, impossible for unmodifiable types</p>
</li>
<li>
<p> <code>@Final</code>   <code>@NotModified</code>: part of {e2immutable}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We therefore color the annotation hierarchy for fields as:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">combination</th>
<th class="tableblock halign-left valign-top">annotation on field</th>
<th class="tableblock halign-left valign-top">green mode</th>
<th class="tableblock halign-left valign-top">red mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{variable}  <code>@Modified</code> </p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">{variable}</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">black</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{variable}  <code>@NotModified</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Final</code>   <code>@Modified</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Modified</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Final</code>   <code>@NotModified</code>, unmodifiable types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Final</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Final</code>   <code>@NotModified</code>, modifiable types only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@NotModified</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{supportData} (when field  <code>@NotModified</code> and owning type {e1immutable})</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{supportData}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green italics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black italics</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The {supportData} annotation is relevant to understand why a type is not level 2 immutable.
In other situations, it simply clutters.
The analyser will only emit it when the type is already {e1immutable} or {e1container}, and the field is already  <code>@NotModified</code>.</p>
</div>
<div class="paragraph">
<p>The plugin transfers dynamic type annotations involving immutability (such as {e2container}) from the field to the type.
As a consequence, the left-hand side <code>Set</code> type will color green in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; strings = <span class="predefined-type">Set</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">abc</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">def</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>according to the first color scheme.</p>
</div>
<div class="paragraph">
<p>Methods declarations mix dependency with modification.
Independence is not necessary when there are no support types, and, given that we only start showing support data types when all fields are  <code>@NotModified</code>, which implies that all methods are  <code>@NotModified</code>, it makes sense to emit the dependency annotations only in the  <code>@NotModified</code> situation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">annotation on method</th>
<th class="tableblock halign-left valign-top">green mode</th>
<th class="tableblock halign-left valign-top">red mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Independent</code>  (implying  <code>@NotModified</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{dependent} (implying  <code>@NotModified</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@NotModified</code> (no support data)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Modified</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">red</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The interesting aspect to constructors is whether they are independent or not.
To be consistent with the system for methods, the analyser will only emit the annotation when the type is showing support data.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">annotation on constructor</th>
<th class="tableblock halign-left valign-top">green mode</th>
<th class="tableblock halign-left valign-top">red mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Independent</code>  (when support data)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{dependent} (when support data)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">brown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no support data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The situation of parameters is binary.
The analyser colors:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">annotation on parameter</th>
<th class="tableblock halign-left valign-top">green mode</th>
<th class="tableblock halign-left valign-top">red mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@NotModified</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>@Modified</code> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">red</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_information_flow">13.3.2. Information flow</h4>
<div class="paragraph">
<p>Exactly which information does the analyser store in the key-value store?
The keys are type names, method names, parameter names, or field names in a format that both analyser and plugin understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for a type, we use the fully qualified name, with sub-types separated by dots;</p>
</li>
<li>
<p>for a method, we use the <em>distinguishing name</em>, which is a slightly custom format that looks like</p>
<div class="paragraph">
<p>type&#8217;s fully qualified name '.' method name '(' parameter type ',' parameter type &#8230;&#8203; ')'</p>
</div>
<div class="paragraph">
<p>where the parameter type is 'T#2' or 'M#0' when it is the third type parameter of the method&#8217;s type, or the first type parameter of the method, respectively.
If the parameter type is not a type parameter, the fully qualified name suffices;</p>
</div>
</li>
<li>
<p>for a parameter, we append the '#' sign followed by the index to the method&#8217;s distinguishing name, starting from 0;</p>
</li>
<li>
<p>for a field, we use the fully qualified name of the type, a ':', and the name of the field.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On top of that comes the combination of a type and a field or method for the dynamic type annotations of fields and methods:
the composite key is the field&#8217;s or method&#8217;s key followed by a space, and the type&#8217;s key.</p>
</div>
<div class="paragraph">
<p>The values consist of a single annotation type name in lowercase, like <em>e2immutable</em> or <em>notmodified</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_2">13.3.3. Implementation</h4>
<div class="paragraph">
<p>The <code>JavaAnnotator</code> class links the plugin to the abstract syntax tree (or PSI in IntelliJ-speak).
It is instrumental to decide which textual elements are to be highlighted.</p>
</div>
<div class="paragraph">
<p>The plugin framework creates the annotator on the basis of the <code>java.xml</code> configuration file.
It is statically connected to the <code>JavaConfig</code> singleton instance which holds the configuration of the plugin.</p>
</div>
<div class="paragraph">
<p>It is also statically connected to the <code>AnnotationStore</code> singleton which is responsible for the assignment of elements to annotations.
Elements will be described in a standardized format which will extend fully qualified type names.
Annotations will be described as the simple names of the e2immu annotations.</p>
</div>
<div class="paragraph">
<p>The annotation store connects to an external server whose address is modifiable in the plugin configuration.
By default, it connects to a local instance on <a href="http://localhost:8281" class="bare">http://localhost:8281</a>. For now, this is a key-value store which keeps track of request and update times.</p>
</div>
<div class="paragraph">
<p>The annotation store keeps a cache where elements have a certain TTL.
As soon as an element is not in the cache, the plugin requests the annotation value from the external server.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_next"><em>Where next?</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many areas for improvement and extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>much better information transfer between analyser, user, and source code</p>
</li>
<li>
<p>towards a full-option static code analyser</p>
</li>
<li>
<p>towards more automation for creating annotated API files</p>
</li>
<li>
<p>more plugins, for other build tools and other IDEs</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copyright_and_license">14. Copyright and License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright &#169; 2020-2021, Bart Naudts, <a href="https://www.e2immu.org" class="bare">https://www.e2immu.org</a></p>
</div>
<div class="paragraph">
<p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU Lesser General Public License for more details.
You should have received a copy of the GNU Lesser General Public License along with this program.
If not, see <a href="http://www.gnu.org/licenses/" class="bare">http://www.gnu.org/licenses/</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-10-24 13:25:55 +0200
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>